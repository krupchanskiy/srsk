<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <script src="js/color-init.js"></script>
    <script>document.documentElement.style.setProperty('--current-color', '#f59e0b');</script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ШРСК — Система управления</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>tailwind.config = { theme: { extend: { screens: { 'desktop': '1200px' } } } }</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/common.css">
</head>
<body class="bg-base-200 min-h-screen flex flex-col">

    <!-- Прелоадер -->
    <div id="pageLoader" class="fixed inset-0 bg-base-200 z-50 flex items-center justify-center">
        <span class="loading loading-spinner loading-lg text-primary"></span>
    </div>

    <main class="container mx-auto px-4 py-8 flex-1">
        <div class="max-w-5xl mx-auto">

            <!-- Header -->
            <div class="flex flex-col sm:flex-row items-center gap-6 mb-10">
                <!-- Logo -->
                <svg id="mainLogo" class="h-28 sm:h-32 w-auto flex-shrink-0" viewBox="0 0 148.95 182.44" xmlns="http://www.w3.org/2000/svg">
                    <style>
                        .logo-text { fill: #13110c; }
                        .logo-accent { fill: var(--current-color); transition: fill 0.3s ease; }
                    </style>
                    <path class="logo-text" d="M24.44,33.99c0-1.56-.46-2.83-1.39-3.81-.93-.98-2.09-1.86-3.48-2.62-1.39-.76-2.91-1.48-4.54-2.14-1.63-.67-3.15-1.48-4.54-2.42-1.39-.95-2.55-2.12-3.48-3.51-.93-1.39-1.39-3.17-1.39-5.32,0-3.05,1.06-5.46,3.18-7.24,2.12-1.78,5.12-2.67,9.02-2.67,2.26,0,4.33.17,6.18.5,1.86.34,3.3.76,4.35,1.28l-1.39,4.12c-.85-.42-2.11-.82-3.76-1.21-1.65-.38-3.52-.58-5.6-.58-2.45,0-4.29.55-5.52,1.64-1.22,1.1-1.84,2.39-1.84,3.87s.46,2.66,1.39,3.62c.93.96,2.09,1.83,3.48,2.59,1.39.76,2.91,1.51,4.54,2.26,1.63.74,3.15,1.61,4.54,2.59,1.39.98,2.55,2.16,3.48,3.54.93,1.38,1.39,3.08,1.39,5.12,0,1.67-.3,3.18-.89,4.51-.59,1.34-1.47,2.49-2.62,3.46-1.15.97-2.54,1.71-4.18,2.23-1.64.52-3.49.78-5.57.78-2.79,0-5.09-.21-6.91-.64-1.82-.43-3.23-.9-4.23-1.42l1.56-4.12c.85.47,2.12.93,3.79,1.38,1.67.45,3.55.68,5.63.68,1.23,0,2.38-.12,3.45-.36,1.08-.24,2.01-.63,2.79-1.17.78-.54,1.4-1.22,1.87-2.03.46-.82.7-1.78.7-2.9"/>
                    <rect class="logo-text" x="61.63" y="4.91" width="4.62" height="38.99"/>
                    <path class="logo-text" d="M33.03,49.86c1.41-.26,3.04-.46,4.87-.61,1.84-.15,3.52-.22,5.04-.22,1.71,0,3.33.19,4.87.56,1.54.37,2.9.98,4.07,1.84,1.17.86,2.11,1.97,2.81,3.34s1.06,3.05,1.06,5.01c0,3.04-.84,5.51-2.51,7.41-1.67,1.89-2.76,2.86-5.32,3.49l10.86,17.79h-5.4l-10.27-16.82h-5.46s0,16.82,0,16.82h-4.62v-38.61ZM43.05,53.04h-1.5c-.52,0-1.02.02-1.5.06-.48.04-.94.08-1.37.11-.43.04-.77.09-1.03.17v14.37h4.34c2.56,0,4.68-.63,6.35-1.89,1.67-1.26,2.51-3.23,2.51-5.9,0-2.01-.69-3.66-2.06-4.96-1.37-1.3-3.29-1.95-5.74-1.95"/>
                    <path class="logo-text" d="M93.74,49.86c1.41-.33,2.93-.56,4.57-.67,1.63-.11,3.25-.17,4.85-.17,1.71,0,3.44.17,5.21.5,1.76.33,3.37.95,4.82,1.84,1.45.89,2.63,2.12,3.54,3.68.91,1.56,1.36,3.55,1.36,5.96s-.43,4.38-1.28,6.02c-.86,1.64-1.99,2.96-3.4,3.98-1.41,1.02-3.03,1.75-4.85,2.2-1.82.45-3.7.67-5.63.67h-.92c-.43,0-.87,0-1.34-.03-.46-.02-.92-.05-1.37-.08-.45-.04-.76-.07-.95-.11v14.82h-4.62v-38.61ZM103.27,53.04c-.97,0-1.89.02-2.79.06-.89.04-1.6.13-2.12.28v16.16c.19.08.48.12.89.14.41.02.84.04,1.28.06.45.02.87.03,1.28.03h.89c1.26,0,2.52-.12,3.76-.36,1.24-.24,2.37-.68,3.37-1.31,1-.63,1.81-1.52,2.42-2.67.61-1.15.92-2.62.92-4.4,0-1.52-.29-2.79-.86-3.81-.58-1.02-1.34-1.84-2.28-2.45-.95-.61-2.01-1.05-3.2-1.31-1.19-.26-2.37-.39-3.56-.39"/>
                    <path class="logo-text" d="M24.44,123.12c0-1.56-.46-2.83-1.39-3.82-.93-.98-2.09-1.86-3.48-2.62-1.39-.76-2.91-1.48-4.54-2.15-1.63-.67-3.15-1.47-4.54-2.42-1.39-.95-2.55-2.12-3.48-3.51-.93-1.39-1.39-3.17-1.39-5.32,0-3.04,1.06-5.46,3.18-7.24,2.12-1.78,5.12-2.67,9.02-2.67,2.26,0,4.33.17,6.18.5,1.86.33,3.3.76,4.35,1.28l-1.39,4.12c-.85-.42-2.11-.82-3.76-1.21-1.65-.38-3.52-.58-5.6-.58-2.45,0-4.29.55-5.52,1.64-1.22,1.1-1.84,2.39-1.84,3.87s.46,2.66,1.39,3.62c.93.97,2.09,1.83,3.48,2.59,1.39.76,2.91,1.51,4.54,2.26,1.63.74,3.15,1.61,4.54,2.59,1.39.98,2.55,2.16,3.48,3.54.93,1.38,1.39,3.08,1.39,5.12,0,1.67-.3,3.18-.89,4.51-.59,1.34-1.47,2.49-2.62,3.45-1.15.97-2.54,1.71-4.18,2.23-1.64.52-3.49.78-5.57.78-2.79,0-5.09-.21-6.91-.64-1.82-.43-3.23-.9-4.23-1.42l1.56-4.12c.85.47,2.12.93,3.79,1.38,1.67.45,3.55.68,5.63.68,1.23,0,2.38-.12,3.45-.36,1.08-.24,2.01-.63,2.79-1.17.78-.54,1.4-1.22,1.87-2.03.46-.82.7-1.78.7-2.9"/>
                    <polygon class="logo-text" points="33.03 94.04 54.74 94.04 54.74 98.16 37.65 98.16 37.65 110.92 52.86 110.92 52.86 115.04 37.65 115.04 37.65 128.91 55.98 128.91 55.98 133.03 33.03 133.03 33.03 94.04"/>
                    <polygon class="logo-text" points="37.85 159.55 37.65 159.55 37.65 177.6 33.03 177.6 33.03 138.6 37.65 138.6 37.65 155.98 37.74 155.98 53.25 138.6 58.6 138.6 41.66 157.13 59.84 177.6 54.47 177.6 37.85 159.55"/>
                    <path class="logo-text" d="M133.09,138.6h4.62v30.42c0,2.97-.66,5.24-1.98,6.8-1.32,1.56-3.31,2.34-5.99,2.34-.3,0-.67-.02-1.11-.06-.45-.04-.89-.09-1.34-.17-.45-.08-.88-.17-1.31-.28-.43-.11-.77-.24-1.03-.39l.89-3.9c1.04.45,2.17.67,3.4.67,1.56,0,2.59-.55,3.09-1.64.5-1.09.75-2.59.75-4.48v-29.3Z"/>
                    <path class="logo-text" d="M101.7,93.43h-2.12l-14.76,39.61h4.62l3.88-10.81h14.3l3.99,10.81h4.9l-14.82-39.61ZM94.82,118.22l5.71-15.69,5.71,15.69h-11.42Z"/>
                    <path class="logo-text" d="M132.22,48.86h-2.12l-14.76,39.61h4.62l3.88-10.81h14.3l3.99,10.81h4.9l-14.82-39.61ZM125.34,73.65l5.71-15.69,5.71,15.69h-11.42Z"/>
                    <path class="logo-text" d="M33.03,5.3c1.41-.26,3.04-.46,4.87-.61,1.84-.15,3.52-.22,5.04-.22,1.71,0,3.33.19,4.87.56,1.54.37,2.9.98,4.07,1.84,1.17.85,2.11,1.97,2.81,3.34s1.06,3.04,1.06,5.01c0,3.05-.84,5.52-2.51,7.41-1.67,1.89-2.76,2.86-5.32,3.49l10.86,17.79h-5.4l-10.27-16.82h-5.46s0,16.82,0,16.82h-4.62V5.3ZM43.05,8.47h-1.5c-.52,0-1.02.02-1.5.06-.48.04-.94.08-1.37.11-.43.04-.77.09-1.03.17v14.37h4.34c2.56,0,4.68-.63,6.35-1.89,1.67-1.26,2.51-3.23,2.51-5.91,0-2-.69-3.66-2.06-4.96-1.37-1.3-3.29-1.95-5.74-1.95"/>
                    <polygon class="logo-text" points="116.31 138.6 116.31 164.01 116.31 167.55 95.09 137.99 92.64 137.99 92.64 177.6 96.98 177.6 96.98 148.4 118.21 178.21 120.66 178.21 120.66 138.6 116.31 138.6"/>
                    <path class="logo-accent" d="M87.13,48.87h-4.62v24.95c0,1.89.04,3.53-.27,4.87-.31,1.36-.79,2.43-1.45,3.22-.61.86-1.48,1.47-2.59,1.84-.73.3-1.55.49-2.47.56-.31.06-.61.1-.92.1h-.19c-1.16-.06-2.2-.25-3.12-.56-1.16-.37-2.14-.95-2.93-1.75-.81-.86-1.39-1.96-1.74-3.32-.37-1.34-.56-3-.56-4.96v-24.95h-4.6v27.15c0,4.17,1.16,7.29,3.49,9.37,1.16,1.05,2.61,1.82,4.33,2.3.36.13.78.23,1.28.29-4.23,1.53-7.11,3.62-8.65,6.25-2.15,3.24-2.21,7.35-.19,12.33l12.59,30.6,12.16-30.6c1.95-4.97,1.89-9.08-.19-12.33-1.47-2.58-4.25-4.63-8.36-6.15.49-.13.97-.26,1.45-.39,1.6-.48,2.95-1.28,4.04-2.37,1.16-1.11,2.03-2.49,2.59-4.14.61-1.71.92-3.74.92-6.08v-26.23M82.69,96.53c1.23,2.21,1.17,5-.17,8.36l-8.02,20.76-8.45-20.76c-1.4-3.36-1.46-6.14-.17-8.36,1.41-2.28,4.19-3.96,8.36-5.06,4.17,1.1,6.98,2.79,8.45,5.06"/>
                    <path class="logo-text" d="M83.56,138.6h-1.05v24.73c0,2,.08,3.83-.31,5.19-.19.65-.29,1.04-.57,1.57-.33.53-.67,1-.98,1.41-.05.07-.11.13-.16.19-.77.79-1.71,1.37-2.84,1.73-1.09.35-1.93.53-3.29.55-1.37-.02-2.21-.21-3.3-.55-1.13-.36-2.07-.94-2.84-1.73-.05-.06-.11-.13-.16-.19-.16-.21-.35-.43-.54-.67-.48-.7-.68-1.14-.96-2.11-.39-1.36-.31-3.28-.31-5.38v-24.73h-4.6v26.91c0,4.23,1.17,7.39,3.51,9.47,1.81,1.61,3.71,2.59,6.6,2.95.7.11,1.45.16,2.33.16.09,0,.17,0,.26,0,.09,0,.17,0,.26,0,.88,0,1.62-.06,2.33-.16,2.89-.37,4.8-1.35,6.6-2.95,2.34-2.08,3.51-5.24,3.51-9.47v-26.91h-3.49Z"/>
                </svg>

                <!-- Welcome text & controls -->
                <div class="flex-1 text-center sm:text-left">
                    <h1 class="text-2xl mb-1">
                        <span id="userName"></span><span data-i18n="welcome_suffix">, добро пожаловать!</span>
                    </h1>
                    <p class="opacity-60 text-sm mb-4">
                        <span data-i18n="welcome_subtitle">Выберите модуль для работы</span>
                        <span data-i18n="welcome_or"> или перейдите в </span><a id="profileLink" href="#" class="link link-hover" style="color: var(--current-color)" data-i18n="welcome_profile">свой профиль</a>
                    </p>
                    <div class="flex items-center justify-center sm:justify-start gap-2">
                        <div class="join bg-white rounded-lg">
                            <button class="join-item btn btn-sm lang-btn bg-white hover:bg-base-200" data-lang="ru">RU</button>
                            <button class="join-item btn btn-sm lang-btn bg-white hover:bg-base-200" data-lang="en">EN</button>
                            <button class="join-item btn btn-sm lang-btn bg-white hover:bg-base-200" data-lang="hi">HI</button>
                        </div>
                        <button class="btn btn-sm btn-ghost" onclick="Layout.logout()" title="Выход">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modules Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">

                <!-- Kitchen Module -->
                <a href="kitchen/menu.html" onclick="selectModule('kitchen')" data-color="#f59e0b"
                   class="module-card group rounded-2xl shadow-md hover:shadow-lg transition-all hover:scale-[1.02]"
                   style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    <div class="p-6">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-white">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8.25v-1.5m0 1.5c-1.355 0-2.697.056-4.024.166C6.845 8.51 6 9.473 6 10.608v2.513m6-4.871c1.355 0 2.697.056 4.024.166C17.155 8.51 18 9.473 18 10.608v2.513M15 8.25v-1.5m-6 1.5v-1.5m12 9.75-1.5.75a3.354 3.354 0 0 1-3 0 3.354 3.354 0 0 0-3 0 3.354 3.354 0 0 1-3 0 3.354 3.354 0 0 0-3 0 3.354 3.354 0 0 1-3 0L3 16.5m18-4.5a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-white" data-i18n="module_kitchen">Кухня</h2>
                        </div>
                        <div class="flex flex-wrap gap-2 text-sm text-white/80">
                            <span data-i18n="nav_menu">Меню</span>
                            <span>•</span>
                            <span data-i18n="nav_recipes">Рецепты</span>
                            <span>•</span>
                            <span data-i18n="nav_stock">Склад</span>
                        </div>
                    </div>
                </a>

                <!-- Housing Module -->
                <a href="placement/timeline.html" onclick="selectModule('housing')" data-color="#8b5cf6"
                   class="module-card group rounded-2xl shadow-md hover:shadow-lg transition-all hover:scale-[1.02]"
                   style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    <div class="p-6">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-white">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-white" data-i18n="module_housing">Проживание</h2>
                        </div>
                        <div class="flex flex-wrap gap-2 text-sm text-white/80">
                            <span data-i18n="nav_timeline">Шахматка</span>
                            <span>•</span>
                            <span data-i18n="nav_vaishnavas">Вайшнавы</span>
                            <span>•</span>
                            <span data-i18n="nav_cleaning">Уборка</span>
                        </div>
                    </div>
                </a>

                <!-- CRM Module -->
                <a href="crm/dashboard.html" onclick="selectModule('crm')" data-color="#10b981"
                   class="module-card group rounded-2xl shadow-md hover:shadow-lg transition-all hover:scale-[1.02]"
                   style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <div class="p-6">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-white">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-white" data-i18n="module_crm">CRM</h2>
                        </div>
                        <div class="flex flex-wrap gap-2 text-sm text-white/80">
                            <span data-i18n="nav_crm_dashboard">Канбан</span>
                            <span>•</span>
                            <span data-i18n="nav_crm_deals">Сделки</span>
                            <span>•</span>
                            <span data-i18n="nav_crm_tasks">Задачи</span>
                        </div>
                    </div>
                </a>

                <!-- Photos Module (только для пользователей с upload_photos) -->
                <a href="photos/upload.html" onclick="selectModule('photos')" id="photosModule" data-color="#ec4899"
                   class="module-card group rounded-2xl shadow-md hover:shadow-lg transition-all hover:scale-[1.02] hidden"
                   style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">
                    <div class="p-6">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-white">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-white" data-i18n="module_photos">Фото</h2>
                        </div>
                        <div class="flex flex-wrap gap-2 text-sm text-white/80">
                            <span data-i18n="nav_upload_photos">Загрузка фото</span>
                            <span>•</span>
                            <span data-i18n="nav_manage_photos">Управление фото</span>
                        </div>
                    </div>
                </a>

                <!-- Admin Module (только для суперпользователей) -->
                <a href="ashram/retreats.html" onclick="selectModule('admin')" id="adminModule" data-color="#374151"
                   class="module-card group rounded-2xl shadow-md hover:shadow-lg transition-all hover:scale-[1.02] hidden"
                   style="background: linear-gradient(135deg, #374151 0%, #1f2937 100%);">
                    <div class="p-6">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-white">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-white" data-i18n="module_admin">Управление</h2>
                        </div>
                        <div class="flex flex-wrap gap-2 text-sm text-white/80">
                            <span data-i18n="nav_retreats">Ретриты</span>
                            <span>•</span>
                            <span data-i18n="nav_festivals">Праздники</span>
                            <span>•</span>
                            <span data-i18n="nav_user_management">Пользователи</span>
                        </div>
                    </div>
                </a>

            </div>
        </div>
    </main>

    <script src="js/config.js?v=2"></script>
    <script src="js/auth-check.js?v=3"></script>
    <script src="js/cache.js"></script>
    <script src="js/utils.js?v=2"></script>
    <script src="js/translit.js"></script>
    <script src="js/auto-translate.js"></script>
    <script src="js/layout.js?v=5"></script>
    <script>
        window.onLanguageChange = function(lang) {
            Layout.updateAllTranslations();
        };

        function selectModule(moduleId) {
            localStorage.setItem('srsk_module', moduleId);
        }

        // Смена цвета тилаки при наведении на плашку модуля
        function setTilakColor(color) {
            document.documentElement.style.setProperty('--current-color', color);
        }

        // Назначаем обработчики после загрузки DOM
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.module-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    const color = card.dataset.color;
                    if (color) setTilakColor(color);
                });
            });
        });

        // Ждём событие authReady от auth-check.js
        function waitForAuth(maxWait = 3000) {
            return new Promise(resolve => {
                if (window.currentUser) {
                    resolve();
                    return;
                }
                const handler = () => resolve();
                window.addEventListener('authReady', handler, { once: true });
                // Таймаут на случай если событие уже было
                setTimeout(() => {
                    window.removeEventListener('authReady', handler);
                    resolve();
                }, maxWait);
            });
        }

        async function init() {
            await Layout.init({ menuId: null, itemId: null });
            await waitForAuth();

            // Показать имя пользователя
            const userName = window.currentUser?.name || '';
            document.getElementById('userName').textContent = userName;

            // Установить ссылку на профиль (гостевой портал)
            const vaishnavaId = window.currentUser?.vaishnava_id;
            if (vaishnavaId) {
                document.getElementById('profileLink').href = `/guest-portal/index.html?view=${vaishnavaId}`;
            }

            // Показать модуль "Фото" только пользователям с upload_photos
            if (window.hasPermission && window.hasPermission('upload_photos')) {
                document.getElementById('photosModule')?.classList.remove('hidden');
            }

            // Показать модуль "Управление" только суперпользователям
            if (window.currentUser?.is_superuser) {
                document.getElementById('adminModule')?.classList.remove('hidden');
            }

            // Установить активную кнопку языка
            const currentLang = localStorage.getItem('srsk_lang') || 'ru';
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLang);
            });

            // Скрыть прелоадер
            document.getElementById('pageLoader')?.remove();
        }

        init();
    </script>
</body>
</html>
