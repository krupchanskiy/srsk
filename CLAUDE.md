# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**–®–†–°–ö** (Sri Rupa Seva Kunja) ‚Äî –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—à—Ä–∞–º–æ–º: –∫—É—Ö–Ω—è, –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ –∏ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, —Ö–∏–Ω–¥–∏) —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å–º–µ–Ω–æ–π –ª–æ–∫–∞—Ü–∏–π.

**Production URL:** https://in.rupaseva.com
**Repository:** https://github.com/krupchanskiy/srsk
**Deployment:** GitHub Pages (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∏–∑ main –≤–µ—Ç–∫–∏)

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–∞–≤–∏–ª–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú –õ–Æ–ë–û–ô –ë–û–õ–¨–®–û–ô/–°–õ–û–ñ–ù–û–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò ‚Äî –í–°–ï–ì–î–ê –°–ü–†–ê–®–ò–í–ê–¢–¨ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –£ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø!**

### –ö–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
- ‚úã –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ Plan Mode —Å –≥–æ—Ç–æ–≤—ã–º –ø–ª–∞–Ω–æ–º ‚Üí –°–ü–†–û–°–ò–¢–¨: "–ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é?"
- ‚úã –ó–∞–¥–∞—á–∞ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úã –ó–∞–¥–∞—á–∞ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úã –ó–∞–¥–∞—á–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úã –õ—é–±–∞—è –∑–∞–¥–∞—á–∞, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–π–º—ë—Ç –±–æ–ª—å—à–µ 5-10 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã
- ‚úã **–ï–°–õ–ò –°–û–ú–ù–ï–í–ê–ï–®–¨–°–Ø ‚Äî –°–ü–†–û–°–ò!**

### –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å—Ä–∞–∑—É:
- ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –û—á–µ–≤–∏–¥–Ω—ã–µ –±–∞–≥–∏ (–æ–ø–µ—á–∞—Ç–∫–∏, –ø—Ä–æ—Å—Ç—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏)
- ‚úÖ –Ø–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "—Å–¥–µ–ª–∞–π X" –≥–¥–µ X ‚Äî –ø—Ä–æ—Å—Ç–∞—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞
- ‚úÖ –ó–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç < 1 –º–∏–Ω—É—Ç—ã

### –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
```
–ü–ª–∞–Ω –≥–æ—Ç–æ–≤. –ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é?
–≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç:
- –°–æ–∑–¥–∞–Ω–∏–µ X –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∏–µ Y HTML —Ñ–∞–π–ª–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ Z –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

[–û—Ç–≤–µ—Ç: –¥–∞/–Ω–µ—Ç]
```

**–ù–ò–ö–û–ì–î–ê –Ω–µ –Ω–∞—á–∏–Ω–∞–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–æ–ª—å—à–æ–π –∑–∞–¥–∞—á–∏ –±–µ–∑ —è–≤–Ω–æ–≥–æ "–¥–∞" –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!**

## Technology Stack

- **Frontend**: Vanilla JS + DaisyUI + Tailwind CSS (CDN)
- **Backend**: Supabase (PostgreSQL + Auth + Realtime)
- **Fonts**: Noto Sans + Noto Sans Devanagari (–¥–ª—è —Ö–∏–Ω–¥–∏)
- **No build step** ‚Äî HTML —Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

## Development

–°–±–æ—Ä–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
# –ü—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –æ—Ç–∫—Ä—ã—Ç—å HTML –Ω–∞–ø—Ä—è–º—É—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open index.html

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Supabase)
npx serve .
```

## Testing

Playwright E2E —Ç–µ—Å—Ç—ã –≤ –ø–∞–ø–∫–µ `tests/`. –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
npx playwright test

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
npx playwright test tests/housing.spec.js

# –° UI
npx playwright test --ui

# –û–¥–∏–Ω —Ç–µ—Å—Ç –ø–æ –∏–º–µ–Ω–∏
npx playwright test -g "–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"
```

–¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 3000.

## Supabase MCP

–ù–∞—Å—Ç—Ä–æ–µ–Ω MCP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î. Project ID: `llttmftapmwebidgevmg`

–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- `mcp__supabase__execute_sql` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
- `mcp__supabase__apply_migration` ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- `mcp__supabase__list_tables` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ö–µ–º—ã
- `mcp__supabase__get_logs` ‚Äî –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- `mcp__supabase__get_advisors` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## Supabase Realtime

Realtime –≤–∫–ª—é—á—ë–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

**–¢–∞–±–ª–∏—Ü—ã —Å Realtime:**
- `residents` ‚Äî –ø—Ä–æ–∂–∏–≤–∞—é—â–∏–µ (—à–∞—Ö–º–∞—Ç–∫–∞, arrivals, departures, preliminary)
- `bookings` ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—à–∞—Ö–º–∞—Ç–∫–∞)
- `room_cleanings` ‚Äî —É–±–æ—Ä–∫–∏ (—à–∞—Ö–º–∞—Ç–∫–∞, cleaning)
- `stock` ‚Äî –æ—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ (stock.html, requests.html)
- `purchase_requests` ‚Äî –∑–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É (requests.html)
- `stock_receipts` ‚Äî –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
- `stock_issuances` ‚Äî –≤—ã–¥–∞—á–∏
- `guest_transfers` ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã (arrivals, departures)
- `retreat_registrations` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Ä–µ—Ç—Ä–∏—Ç—ã (preliminary)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (placement/timeline.html):**
```javascript
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
Layout.db.channel('timeline-realtime')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'residents' }, handler)
    .on('postgres_changes', { event: '*', schema: 'public', table: 'bookings' }, handler)
    .subscribe();

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å debounce 500–º—Å
function handler(payload) {
    await loadTimelineData();
    renderTable();
}
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Realtime –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
1. –í–∫–ª—é—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É: `ALTER PUBLICATION supabase_realtime ADD TABLE tablename;`
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –≤ JS (—Å–º. –ø—Ä–∏–º–µ—Ä –≤—ã—à–µ)

## Architecture

### Core Files

- **js/config.js** ‚Äî –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø–æ–¥–∫–ª—é—á–∞—Ç—å –ü–ï–†–í–´–ú):
  - `CONFIG.SUPABASE_URL` –∏ `CONFIG.SUPABASE_ANON_KEY`
  - –°–æ–∑–¥–∞–Ω –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è credentials

- **js/layout.js** ‚Äî –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü:
  - –•–µ–¥–µ—Ä, —Ñ—É—Ç–µ—Ä, –Ω–∞–≤–∏–≥–∞—Ü–∏—è
  - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ –∏ –ª–æ–∫–∞—Ü–∏–π
  - Supabase –∫–ª–∏–µ–Ω—Ç (`Layout.db`)
  - –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ `Layout.t(key)`
  - –£—Ç–∏–ª–∏—Ç—ã: `Layout.getName()`, `Layout.pluralize()`, `Layout.debounce()`, `Layout.escapeHtml()`
  - –ü—Ä–µ–ª–æ–∞–¥–µ—Ä: `Layout.showLoader()`, `Layout.hideLoader()`
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: `Layout.handleError(error, context)` ‚Äî toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + console.error
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: `Layout.showNotification(message, type)` ‚Äî type: 'info', 'success', 'warning', 'error'
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤: `Layout.formatQuantity(amount, unit)` ‚Äî –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö
    - g, ml, tsp, tbsp ‚Üí –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    - kg, l, pcs, cup ‚Üí –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
  - –û–±—ë—Ä–Ω—É—Ç –≤ IIFE –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

- **js/utils.js** ‚Äî –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã:
  - `Utils.isValidColor(color)` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è hex-—Ü–≤–µ—Ç–æ–≤ (#RRGGBB)

- **js/cache.js** ‚Äî –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫—ç—à —Å localStorage:
  - `Cache.getOrLoad(key, loadFn, ttl)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫—ç—à–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å
  - `Cache.invalidate(key)` ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞

- **js/vaishnavas-utils.js** ‚Äî –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è vaishnavas/index.html, team.html, guests.html:
  - –ü–æ–∏—Å–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ –ª—é–¥–µ–π
  - –†–µ–Ω–¥–µ—Ä —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã (`VaishnavasUtils.renderPersonRow()`)
  - –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (`VaishnavasUtils.openAddModal()`, `saveNewPerson()`)
  - –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è (`loadStays()`, `isPresent()`)
  - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `window.VaishnavasUtils`

- **js/color-init.js** ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–≤–µ—Ç–∞ –º–æ–¥—É–ª—è –¥–æ —Ä–µ–Ω–¥–µ—Ä–∞ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç FOUC). –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –≤ `<head>` –∫–∞–∂–¥–æ–≥–æ HTML —Ñ–∞–π–ª–∞.

- **css/common.css** ‚Äî –û–±—â–∏–µ —Å—Ç–∏–ª–∏, CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `--current-color` –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ –ª–æ–∫–∞—Ü–∏–∏

### Page Structure

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:
```html
<head>
    <script src="../js/color-init.js"></script> <!-- –∏–ª–∏ js/color-init.js –¥–ª—è –∫–æ—Ä–Ω–µ–≤—ã—Ö -->
</head>
<body>
    <div id="header-placeholder"></div>
    <main>...</main>
    <div id="footer-placeholder"></div>
    <script src="../js/config.js"></script> <!-- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ü–ï–†–í–´–ú -->
    <script src="../js/cache.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/layout.js"></script>
    <script src="../js/vaishnavas-utils.js"></script> <!-- —Ç–æ–ª—å–∫–æ –¥–ª—è vaishnavas/ -->
    <script>
        const t = key => Layout.t(key);
        async function init() {
            await Layout.init({ module: 'housing', menuId: 'housing', itemId: 'timeline' });
            Layout.showLoader();
            // load page data...
            Layout.hideLoader();
        }
        init();
    </script>
</body>
```

### i18n System

- –ü–µ—Ä–µ–≤–æ–¥—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `translations` (key ‚Üí ru, en, hi)
- `Layout.t('key')` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞
- `data-i18n="key"` –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `data-i18n-placeholder="key"` –¥–ª—è placeholder'–æ–≤
- `window.onLanguageChange(lang)` ‚Äî –∫–æ–ª–±—ç–∫ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ø–µ—Ä–µ–≤–æ–¥—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ localStorage —á–µ—Ä–µ–∑ `Cache.getOrLoad('translations', ...)`
- **–ê–≤—Ç–æ–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:** –µ—Å–ª–∏ –≤ –∫—ç—à–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫), –∫—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è

**–ö–ª—é—á–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤:**
- `arrivals`, `departures`, `transfers_title` ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
- `flight_arrival`, `will_arrive_to_srsc`, `departure_from_srsc`, `flight_departure` ‚Äî –∫–æ–ª–æ–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü
- `needs_transfer` ("–ù—É–∂–Ω–æ —Ç–∞–∫—Å–∏"), `ordered` ("–ó–∞–∫–∞–∑–∞–Ω–æ"), `taxi_ordered` ("–¢–∞–∫—Å–∏ –∑–∞–∫–∞–∑–∞–Ω–æ")
- `driver_info`, `ordered_by` ‚Äî –ø–æ–ª—è –º–æ–¥–∞–ª–∫–∏ —Ç–∞–∫—Å–∏
- `specify_your_name`, `error_saving`, `cancel_error` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è

### Database Tables

–û—Å–Ω–æ–≤–Ω—ã–µ:
- `locations` ‚Äî –∫—É—Ö–Ω–∏ (main, cafe, guest) —Å —Ü–≤–µ—Ç–∞–º–∏
- `recipes`, `recipe_categories`, `recipe_ingredients` ‚Äî —Ä–µ—Ü–µ–ø—Ç—ã
- `products`, `product_categories`, `product_densities` ‚Äî –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –µ–¥–∏–Ω–∏—Ü
  - `waste_percent` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç—Ö–æ–¥–æ–≤ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ (–æ–≤–æ—â–∏/—Ñ—Ä—É–∫—Ç—ã). –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–æ–∫ –∏ –≤—ã–¥–∞—á–µ
  - **–§–æ—Ä–º—É–ª–∞:** `–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–¥–ª—è_–∑–∞–∫—É–ø–∫–∏ = –Ω—É–∂–Ω–æ_–æ—á–∏—â–µ–Ω–Ω–æ–π / (1 - waste_percent / 100)`
  - **–ü—Ä–∏–º–µ—Ä:** –Ω—É–∂–Ω–æ 1 –∫–≥ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—è –æ—á–∏—â–µ–Ω–Ω–æ–≥–æ (waste_percent=20) ‚Üí –∑–∞–∫—É–ø–∞—Ç—å 1 / 0.8 = 1.25 –∫–≥
- `units` ‚Äî –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
- `translations` ‚Äî –ø–µ—Ä–µ–≤–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- `menu_days`, `menu_items`, `menu_templates` ‚Äî –º–µ–Ω—é
- `stock`, `stock_requests`, `stock_inventories` ‚Äî —Å–∫–ª–∞–¥ –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è
- `stock_issuances` ‚Äî –≤—ã–¥–∞—á–∏ —Å–æ —Å–∫–ª–∞–¥–∞ (`receiver_id` ‚Üí vaishnavas)
- `retreats`, `holidays` ‚Äî —Ä–µ—Ç—Ä–∏—Ç—ã –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏

–í–∞–π—à–Ω–∞–≤—ã (–ª—é–¥–∏):
- `vaishnavas` ‚Äî –µ–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤—Å–µ—Ö –ª—é–¥–µ–π (–≥–æ—Å—Ç–∏ + –∫–æ–º–∞–Ω–¥–∞)
  - `spiritual_teacher` ‚Äî –¥—É—Ö–æ–≤–Ω—ã–π —É—á–∏—Ç–µ–ª—å (–¥–ª—è –≤—Å–µ—Ö)
  - `is_team_member` ‚Äî —Ñ–ª–∞–≥ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–æ–º–∞–Ω–¥–µ
  - `department_id` ‚Äî –æ—Ç–¥–µ–ª (–¥–ª—è –∫–æ–º–∞–Ω–¥—ã)
  - `service` ‚Äî —Å–ª—É–∂–µ–Ω–∏–µ (–¥–ª—è –∫–æ–º–∞–Ω–¥—ã)
  - `senior_id` ‚Üí `vaishnavas` ‚Äî —Å—Ç–∞—Ä—à–∏–π (–¥–ª—è –∫–æ–º–∞–Ω–¥—ã)
- `vaishnava_stays` ‚Äî –ø–µ—Ä–∏–æ–¥—ã –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è —á–ª–µ–Ω–æ–≤ –∫–æ–º–∞–Ω–¥—ã
- `departments` ‚Äî –æ—Ç–¥–µ–ª—ã (–∫—É—Ö–Ω—è, –ø—É–¥–∂–∞—Ä–∏ –∏ —Ç.–¥.)

Housing (–º–æ–¥—É–ª—å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è):
- `buildings`, `building_types` ‚Äî –∑–¥–∞–Ω–∏—è
  - `is_temporary` + `available_from`/`available_until` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è —Å –¥–∞—Ç–∞–º–∏
  - `is_temporary` + NULL dates ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–≥–¥–∞)
  - `sort_order` –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞: 1-10 –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ, 50-59 –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±–µ–∑ –¥–∞—Ç, 100+ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –¥–∞—Ç–∞–º–∏
- `rooms`, `room_types` ‚Äî –∫–æ–º–Ω–∞—Ç—ã
- `residents`, `resident_categories` ‚Äî –ø—Ä–æ–∂–∏–≤–∞—é—â–∏–µ (—Å–≤—è–∑—å —á–µ—Ä–µ–∑ `vaishnava_id`)
  - `room_id` –º–æ–∂–µ—Ç –±—ã—Ç—å NULL = "–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ" (–≥–æ—Å—Ç—å –∂–∏–≤–µ—Ç –≤–Ω–µ –∞—à—Ä–∞–º–∞)
- `bookings` ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `room_cleanings`, `cleaning_tasks` ‚Äî —É–±–æ—Ä–∫–∞
- `floor_plans` ‚Äî –ø–ª–∞–Ω—ã —ç—Ç–∞–∂–µ–π (SVG)

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Ä–µ—Ç—Ä–∏—Ç—ã:
- `retreat_registrations` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Å–≤—è–∑—å —á–µ—Ä–µ–∑ `vaishnava_id`)
  - `status` ‚Äî constraint: `'guest'`, `'team'`, `'cancelled'` (–ù–ï 'registered', 'confirmed', 'pending')
- `guest_visas`, `guest_payments`, `guest_transfers` ‚Äî –¥–µ—Ç–∞–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `guest_notes` ‚Äî –∑–∞–º–µ—Ç–∫–∏ –æ –≥–æ—Å—Ç—è—Ö
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –≥–æ—Å—Ç–µ–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `residents` (–µ–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —à–∞—Ö–º–∞—Ç–∫–æ–π)

### SQL Migrations

–§–∞–π–ª—ã –≤ `supabase/` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø–æ –Ω–æ–º–µ—Ä–∞–º (001-097+):
- `001-010` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞, seed-–¥–∞–Ω–Ω—ã–µ, —Ä–µ—Ü–µ–ø—Ç—ã
- `011-030` ‚Äî –ø–µ—Ä–µ–≤–æ–¥—ã, RLS-–ø–æ–ª–∏—Ç–∏–∫–∏, —Å–∫–ª–∞–¥, –∫–æ–º–∞–Ω–¥–∞
- `031-050` ‚Äî –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è, –º–µ–Ω—é-—à–∞–±–ª–æ–Ω—ã, —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
- `051-066` ‚Äî –º–æ–¥—É–ª—å Housing (–∑–¥–∞–Ω–∏—è, –∫–æ–º–Ω–∞—Ç—ã, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —É–±–æ—Ä–∫–∞)
- `073-078` ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏
- `079-097` ‚Äî **Legacy:** –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ–∏–∫—Å—ã RLS-—Ä–µ–∫—É—Ä—Å–∏–∏ (–∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã –≤ cleanup_redundant_rls_policies)
- `cleanup_redundant_rls_policies*` ‚Äî –æ—á–∏—Å—Ç–∫–∞ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö RLS –ø–æ–ª–∏—Ç–∏–∫ (2026-02-01)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ú–∏–≥—Ä–∞—Ü–∏–∏ 079-097 —Å–æ–¥–µ—Ä–∂–∞—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π RLS-–ø–æ–ª–∏—Ç–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ–∫—É—Ä—Å–∏–∏. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ ‚Äî —ç—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∏–∑—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏.

–ü—Ä–∏–º–µ–Ω—è—Ç—å —á–µ—Ä–µ–∑ MCP `mcp__supabase__apply_migration` –∏–ª–∏ Supabase SQL Editor.

### User Management & RBAC System

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- `modules` ‚Äî –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã (kitchen, housing)
- `permissions` ‚Äî –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –ø—Ä–∞–≤–∞ (view_menu, edit_rooms –∏ —Ç.–¥.)
- `roles` ‚Äî —Ä–æ–ª–∏ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª—è —Å –Ω–∞–±–æ—Ä–æ–º –ø—Ä–∞–≤
- `role_permissions` ‚Äî —Å–≤—è–∑—å —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤
- `user_roles` ‚Äî –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `user_permissions` ‚Äî –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∞–≤ (is_granted: true/false)
- `superusers` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ UUID —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±–µ–∑ RLS –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤)

**–¢–∏–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- **Staff (–∫–æ–º–∞–Ω–¥–∞)** ‚Äî –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª–∏
- **Guest (–≥–æ—Å—Ç—å)** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–µ–º—É –ø—Ä–æ—Ñ–∏–ª—é
- **Superuser** ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É, –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

**RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (82 –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ 64 —Ç–∞–±–ª–∏—Ü—ã):**
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü –∏–º–µ—é—Ç –æ–¥–Ω—É –ø–æ–ª–∏—Ç–∏–∫—É `FOR ALL` —Å —É—Å–ª–æ–≤–∏–µ–º `true` (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è authenticated)
- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏: `FOR ALL` –¥–ª—è authenticated + `SELECT` –¥–ª—è public/anon
- –¢–∞–±–ª–∏—Ü–∞ `superusers` –∏–º–µ–µ—Ç RLS disabled –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Ä–µ–∫—É—Ä—Å–∏–∏
- –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `auth.uid() IN (SELECT user_id FROM superusers)`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–∏—Ç–∏–∫ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ (2026-02-01):**
- 47 —Ç–∞–±–ª–∏—Ü: 1 –ø–æ–ª–∏—Ç–∏–∫–∞ (ALL)
- 12 —Ç–∞–±–ª–∏—Ü: 2 –ø–æ–ª–∏—Ç–∏–∫–∏ (ALL –¥–ª—è write + SELECT –¥–ª—è public read)
- 4 —Ç–∞–±–ª–∏—Ü—ã —Å –æ—Å–æ–±—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏: vaishnavas, profiles, translations, price_history

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**
- `staff-signup.html` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã (approval_status = 'pending')
- `guest-signup.html` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Å—Ç—è (approval_status = 'approved')
- `pending-approval.html` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è
- `settings/user-management.html` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏

**js/auth-check.js:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö (–∫—Ä–æ–º–µ login/signup)
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `window.currentUser.permissions`
- –°–æ–∑–¥–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `window.hasPermission(permCode)`
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≥–æ—Å—Ç–µ–π —Ç–æ–ª—å–∫–æ –∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–º
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç pending/rejected/blocked –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## Key Patterns

### –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤
```javascript
Layout.getName(item)  // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç item.name_ru / name_en / name_hi
```

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –≤–∞–π—à–Ω–∞–≤–∞
**–í–ê–ñ–ù–û:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
```javascript
// –ü—Ä–∞–≤–∏–ª—å–Ω–æ: spiritual_name –ò–õ–ò –ø–æ–ª–Ω–æ–µ –∏–º—è (first_name + last_name)
const name = vaishnava.spiritual_name ||
             `${vaishnava.first_name || ''} ${vaishnava.last_name || ''}`.trim() ||
             '–ë–µ–∑ –∏–º–µ–Ω–∏';

// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ first_name –±–µ–∑ last_name
const name = vaishnava.spiritual_name || vaishnava.first_name; // ‚ùå
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ï—Å–ª–∏ –Ω–µ—Ç –¥—É—Ö–æ–≤–Ω–æ–≥–æ –∏–º–µ–Ω–∏, –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω–æ–µ –∏–º—è (–ò–º—è –§–∞–º–∏–ª–∏—è), –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∏–º—è.

### –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤
```javascript
const FORMS = {
    ru: ['—Ä–µ—Ü–µ–ø—Ç', '—Ä–µ—Ü–µ–ø—Ç–∞', '—Ä–µ—Ü–µ–ø—Ç–æ–≤'],
    en: ['recipe', 'recipes'],
    hi: '‡§µ‡•ç‡§Ø‡§Ç‡§ú‡§®'  // –Ω–µ —Å–∫–ª–æ–Ω—è–µ—Ç—Å—è
};
Layout.pluralize(5, FORMS)  // "5 —Ä–µ—Ü–µ–ø—Ç–æ–≤"
```

### –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤
–í—Å–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –ë–î —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö –ø—Ä–æ–¥—É–∫—Ç–∞ (kg, g, l, ml, pcs), **–±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –±–∞–∑–æ–≤—ã–µ –µ–¥–∏–Ω–∏—Ü—ã**. –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç –∏–º–µ–µ—Ç `unit='kg'`, —Ç–æ `quantity=0.5` –æ–∑–Ω–∞—á–∞–µ—Ç 0.5 –∫–≥.

### –£—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –Ω–∞ –æ—á–∏—Å—Ç–∫—É (waste_percent)
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–æ–∫ (`stock/requests.html`) –∏ –≤—ã–¥–∞—á–µ —Å–æ —Å–∫–ª–∞–¥–∞ (`stock/issue.html`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç—Ö–æ–¥–æ–≤ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –æ–≤–æ—â–µ–π/—Ñ—Ä—É–∫—Ç–æ–≤.

**–§–æ—Ä–º—É–ª–∞:**
```javascript
const wastePercent = product.waste_percent || 0;
const quantityToPurchase = wastePercent > 0
    ? neededQuantity / (1 - wastePercent / 100)
    : neededQuantity;
```

**–õ–æ–≥–∏–∫–∞:** –ï—Å–ª–∏ 80% –æ—Ç –Ω–µ—á–∏—â–µ–Ω–æ–π –º–∞—Å—Å—ã —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç —á–∏—Å—Ç–∞—è (waste_percent=20%), —Ç–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è 1 –∫–≥ —á–∏—â–µ–Ω–æ–π –Ω—É–∂–Ω–æ: 1 / 0.8 = 1.25 –∫–≥ –Ω–µ—á–∏—â–µ–Ω–æ–π.

**–ü—Ä–∏–º–µ—Ä—ã:**
- –†–µ—Ü–µ–ø—Ç—É –Ω—É–∂–Ω–æ 1 –∫–≥ –æ—á–∏—â–µ–Ω–Ω–æ–≥–æ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—è (waste_percent = 20%)
  - –ó–∞–∫—É–ø–∏—Ç—å: 1 / (1 - 0.20) = 1 / 0.8 = **1.25 –∫–≥**
- –†–µ—Ü–µ–ø—Ç—É –Ω—É–∂–Ω–æ 10 –∫–≥ –±—Ä–æ–∫–∫–æ–ª–∏ (waste_percent = 50%)
  - –ó–∞–∫—É–ø–∏—Ç—å: 10 / (1 - 0.50) = 10 / 0.5 = **20 –∫–≥**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (2026-01-31):**
- `requests.html:addProductToRequest()` ‚Äî –ø—Ä–∏ —Ä—É—á–Ω–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
- `requests.html:generateRequest()` ‚Äî –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –∏–∑ –º–µ–Ω—é
- `issue.html:addIssuanceItem()` ‚Äî –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –≤—ã–¥–∞—á—É
- **UI –ø–æ—è—Å–Ω–µ–Ω–∏–µ:** –ø–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç `(+50% –Ω–∞ –æ—á–∏—Å—Ç–∫—É)` –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏

### –¶–≤–µ—Ç –º–æ–¥—É–ª—è
CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `--current-color` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç:
- **Kitchen**: `#f49800` (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
- **Housing**: `#8b5cf6` (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫–Ω–æ–ø–æ–∫, –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–±–æ–≤, –ø–æ–¥–º–µ–Ω—é. –¶–≤–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `js/color-init.js` –≤ `<head>` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–∏–≥–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.

### Supabase –∑–∞–ø—Ä–æ—Å—ã
```javascript
// –£–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è –≤–º–µ—Å—Ç–æ select('*')
const { data, error } = await Layout.db
    .from('recipes')
    .select('id, name_ru, name_en, name_hi, recipe_categories(id, name_ru, name_en, name_hi)')
    .order('name_ru');
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```javascript
// –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ‚Äî toast + console.error
if (error) {
    Layout.handleError(error, '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤');
    return;
}

// –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ
Layout.showNotification('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
Layout.showNotification('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π', 'warning');

// –ù–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ alert() ‚Äî –∑–∞–º–µ–Ω—è—Ç—å –Ω–∞ Layout.showNotification()
```

## Menu Structure

–î–≤–∞ –º–æ–¥—É–ª—è —Å —Ä–∞–∑–Ω—ã–º–∏ –º–µ–Ω—é (—Å–º. `js/layout.js`):

**Kitchen** (–∫—É—Ö–Ω—è):
- kitchen: menu, menu_templates, recipes, products
- stock: stock_balance, requests, receive, issue, inventory, stock_settings
- ashram: retreats, vaishnavas_team
- settings: dictionaries, translations, festivals

**Housing** (–ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ):
- vaishnavas: vaishnavas_all, vaishnavas_guests, vaishnavas_team
- placement: retreat_guests (–ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ), preliminary (–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ), arrivals, departures, transfers
- reception: floor_plan, cleaning, buildings, rooms, housing_dictionaries
- ashram: retreats, festivals
- settings: buildings, rooms, housing_dictionaries

**–û–±—â–µ–µ:** —Ä–∞–∑–¥–µ–ª ¬´–ê—à—Ä–∞–º¬ª (retreats, festivals) –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ–±–æ–∏—Ö –º–æ–¥—É–ª—è—Ö.

–ö–ª—é—á–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤: `nav_kitchen`, `nav_vaishnavas_team`, etc.

**–í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è:**
- `nav_retreat_guests` ‚Äî "–ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ" (–±—ã–≤—à–µ–µ "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ")
- `nav_preliminary` ‚Äî "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ" (–±—ã–≤—à–µ–µ "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ")
- `retreat_guests` –∏ `preliminary` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –¥–ª—è layout.js

## Language

–í–µ—Å—å –∫–æ–¥, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –∫–æ–º–º–∏—Ç—ã ‚Äî –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

## UI/UX Rules

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

1. **–ß–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –±–µ–∑ —Å—Ç—Ä–µ–ª–æ–∫** ‚Äî –≤—Å–µ `input[type="number"]` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–µ–∑ spinners (—Å—Ç—Ä–µ–ª–æ–∫ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑). –°—Ç–∏–ª–∏ —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤ `common.css`.

2. **–¶–≤–µ—Ç –ª–æ–∫–∞—Ü–∏–∏** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--current-color` –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

3. **–¢—Ä—ë—Ö—è–∑—ã—á–Ω–æ—Å—Ç—å** ‚Äî –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã (ru, en, hi).

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ—Ç XSS**:
   - –ù–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ `innerHTML` —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DOM API: `textContent`, `createElement()`, `appendChild()`
   - –î–ª—è HTML –∏–∑ –ë–î –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Layout.escapeHtml()`
   - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π –≤ style: `Utils.isValidColor(color)`

5. **Inline onclick** ‚Äî –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—Ç—å event delegation –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–ø–æ–∏—Å–∫, –º–æ–¥–∞–ª–∫–∏) inline –¥–æ–ø—É—Å—Ç–∏–º:
   ```javascript
   // Event delegation –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   document.addEventListener('click', (e) => {
       const action = e.target.closest('[data-action]');
       if (action?.dataset.action === 'delete-item') {
           deleteItem(action.dataset.id);
       }
   });

   // Inline –¥–æ–ø—É—Å—Ç–∏–º –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   <input oninput="onSearchInput(this.value)" />
   <button onclick="openModal()">–û—Ç–∫—Ä—ã—Ç—å</button>
   ```

6. **–ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ —Å –∫—Ä–µ—Å—Ç–∏–∫–æ–º** ‚Äî –≤—Å–µ –ø–æ–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –∫–Ω–æ–ø–∫—É –æ—á–∏—Å—Ç–∫–∏ (√ó), –∫–æ—Ç–æ—Ä–∞—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ –∏ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ. –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–º. –≤ `vaishnavas/index.html`.

## Storage Buckets

Supabase Storage buckets —Å –ø—É–±–ª–∏—á–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º:
- `vaishnava-photos` ‚Äî —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤–∞–π—à–Ω–∞–≤–æ–≤
- `floor-plans` ‚Äî –ø–ª–∞–Ω—ã —ç—Ç–∞–∂–µ–π (SVG)
- `guest-photos` ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å vaishnava-photos

–î–ª—è –∫–∞–∂–¥–æ–≥–æ bucket –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å RLS-–ø–æ–ª–∏—Ç–∏–∫–∏ (SELECT, INSERT, UPDATE, DELETE).

## Common Issues

1. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º—ë–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `t`** ‚Äî layout.js –æ–±—ë—Ä–Ω—É—Ç –≤ IIFE, –Ω–æ –µ—Å–ª–∏ –æ–±—ä—è–≤–∏—Ç—å `const t` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–æ –≤—ã–∑–æ–≤–∞ `Layout.t`, –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç.
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `const t = key => Layout.t(key);` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ layout.js
   - –í —Ü–∏–∫–ª–∞—Ö/—Ñ—É–Ω–∫—Ü–∏—è—Ö –≥–¥–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `t` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ü–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, transfer –æ–±—ä–µ–∫—Ç), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Layout.t()` –Ω–∞–ø—Ä—è–º—É—é

2. **RLS –Ω–∞ Supabase** ‚Äî –ø—Ä–∏ update/insert —Å `.select().single()` –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –µ—Å–ª–∏ RLS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.select()` –∏ –±–µ—Ä–∏—Ç–µ `result.data?.[0]`.

3. **Storage RLS** ‚Äî –ø—Ä–∏ –æ—à–∏–±–∫–µ "new row violates row-level security policy" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å RLS-–ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è storage.objects.

4. **Skeleton loaders** ‚Äî HTML —Å–æ–¥–µ—Ä–∂–∏—Ç skeleton-–∫–∞—Ä—Ç–æ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

5. **–ö—ç—à –ø–µ—Ä–µ–≤–æ–¥–æ–≤** ‚Äî –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ –ë–î –∫—ç—à –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π (—Å–º. `loadTranslations()` –≤ layout.js)
   - –í—Ä—É—á–Ω—É—é: `Cache.invalidate('translations'); location.reload();` –≤ –∫–æ–Ω—Å–æ–ª–∏
   - –ò–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –æ—á–∏—Å—Ç–∫–æ–π: `Ctrl+Shift+R`

6. **Browser back-forward cache (bfcache)** ‚Äî –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ "–ù–∞–∑–∞–¥" —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –∫—ç—à–∞ –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è JS:
   ```javascript
   window.addEventListener('pageshow', (event) => {
       if (event.persisted) {
           // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å UI —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
           renderTable();
       }
   });
   ```

7. **N+1 –∑–∞–ø—Ä–æ—Å—ã** ‚Äî –∏–∑–±–µ–≥–∞—Ç—å —Ü–∏–∫–ª–æ–≤ —Å await –≤–Ω—É—Ç—Ä–∏. –ó–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º —Å `.in()` –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:
```javascript
// –ü–ª–æ—Ö–æ: N+1 –∑–∞–ø—Ä–æ—Å–æ–≤
for (const booking of bookings) {
    const { data } = await Layout.db.from('residents').select('*').eq('booking_id', booking.id);
}

// –•–æ—Ä–æ—à–æ: 1 –∑–∞–ø—Ä–æ—Å
const { data: allResidents } = await Layout.db.from('residents').select('*').in('booking_id', bookingIds);
const grouped = allResidents.reduce((acc, r) => { (acc[r.booking_id] ||= []).push(r); return acc; }, {});
```

8. **RLS —Ä–µ–∫—É—Ä—Å–∏—è** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 2026-02-01) ‚Äî –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ RLS –ø–æ–ª–∏—Ç–∏–∫ –∏–∑–±–µ–≥–∞—Ç—å –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —á–∏—Ç–∞—é—Ç —Ç—É –∂–µ —Ç–∞–±–ª–∏—Ü—É:
   - ‚ùå –ü–õ–û–•–û: –ø–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ `user_permissions` –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é ‚Üí —Ñ—É–Ω–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç `vaishnavas` ‚Üí –ø–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ `vaishnavas` –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é ‚Üí —Ä–µ–∫—É—Ä—Å–∏—è
   - ‚úÖ –•–û–†–û–®–û: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –±–µ–∑ RLS (`superusers`) –∏–ª–∏ inline SQL –±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–π
   - –§—É–Ω–∫—Ü–∏–∏ —Å `SECURITY DEFINER` –æ–±—Ö–æ–¥—è—Ç RLS, –Ω–æ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫
   - –ü–æ–ª–∏—Ç–∏–∫–∞ `FOR ALL` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è INSERT/UPDATE/DELETE –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - **–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:** –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ `FOR ALL USING (true)`, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## File Locations

```
/                   # –∫–æ—Ä–µ–Ω—å (index.html, login.html)
‚îú‚îÄ‚îÄ kitchen/        # —Ä–µ—Ü–µ–ø—Ç—ã, –º–µ–Ω—é, –ø—Ä–æ–¥—É–∫—Ç—ã
‚îú‚îÄ‚îÄ stock/          # —Å–∫–ª–∞–¥, –∑–∞—è–≤–∫–∏, –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ ashram/         # —Ä–µ—Ç—Ä–∏—Ç—ã, –ø—Ä–∞–∑–¥–Ω–∏–∫–∏
‚îú‚îÄ‚îÄ vaishnavas/     # –º–æ–¥—É–ª—å Housing: –±–∞–∑–∞ –ª—é–¥–µ–π (–≤—Å–µ, –≥–æ—Å—Ç–∏, –∫–æ–º–∞–Ω–¥–∞)
‚îú‚îÄ‚îÄ placement/      # –º–æ–¥—É–ª—å Housing: —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–∞–π–º–ª–∞–π–Ω, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã)
‚îú‚îÄ‚îÄ reception/      # –º–æ–¥—É–ª—å Housing: —Ä–µ—Å–µ–ø—à–µ–Ω (—à–∞—Ö–º–∞—Ç–∫–∞, —É–±–æ—Ä–∫–∞, –∫–æ–º–Ω–∞—Ç—ã, –∑–¥–∞–Ω–∏—è)
‚îú‚îÄ‚îÄ settings/       # –ø–µ—Ä–µ–≤–æ–¥—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îú‚îÄ‚îÄ css/            # common.css
‚îú‚îÄ‚îÄ js/             # layout.js, vaishnavas-utils.js, color-init.js
‚îú‚îÄ‚îÄ supabase/       # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏ (001-097+)
‚îî‚îÄ‚îÄ docs/           # –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –°–ª–æ–≤–∞—Ä—å —Å—Ç—Ä–∞–Ω–∏—Ü

–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫: —á—Ç–æ –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è.

### vaishnavas/ (–í–∞–π—à–Ω–∞–≤—ã)
| –¢–µ—Ä–º–∏–Ω | –§–∞–π–ª |
|--------|------|
| –í—Å–µ –≤–∞–π—à–Ω–∞–≤—ã | `vaishnavas/index.html` |
| –ö–æ–º–∞–Ω–¥–∞ | `vaishnavas/team.html` |
| –ì–æ—Å—Ç–∏ | `vaishnavas/guests.html` |
| –ü—Ä–æ—Ñ–∏–ª—å –≤–∞–π—à–Ω–∞–≤–∞ | `vaishnavas/person.html` |

### placement/ (–†–∞–∑–º–µ—â–µ–Ω–∏–µ)
| –¢–µ—Ä–º–∏–Ω | –§–∞–π–ª |
|--------|------|
| –ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ (–∏–º–ø–æ—Ä—Ç CSV) | `vaishnavas/retreat-guests.html` |
| –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ) | `vaishnavas/preliminary.html` |
| –®–∞—Ö–º–∞—Ç–∫–∞ (timeline) | `placement/timeline.html` |
| –ó–∞–µ–∑–¥—ã | `placement/arrivals.html` |
| –í—ã–µ–∑–¥—ã | `placement/departures.html` |
| –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã | `placement/transfers.html` |

### reception/ (–†–µ—Å–µ–ø—à–µ–Ω)
| –¢–µ—Ä–º–∏–Ω | –§–∞–π–ª |
|--------|------|
| –ü–ª–∞–Ω—ã —ç—Ç–∞–∂–µ–π | `reception/floor-plan.html` |
| –†–µ–¥–∞–∫—Ç–æ—Ä –ø–ª–∞–Ω–æ–≤ | `reception/floor-plan-editor.html` |
| –£–±–æ—Ä–∫–∞ | `reception/cleaning.html` |
| –ö–æ–º–Ω–∞—Ç—ã | `reception/rooms.html` |
| –ó–¥–∞–Ω–∏—è | `reception/buildings.html` |
| –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (—Ä–µ—Å–µ–ø—à–µ–Ω) | `reception/dictionaries.html` |

### kitchen/ (–ö—É—Ö–Ω—è)
| –¢–µ—Ä–º–∏–Ω | –§–∞–π–ª |
|--------|------|
| –†–µ—Ü–µ–ø—Ç—ã (—Å–ø–∏—Å–æ–∫) | `kitchen/recipes.html` |
| –†–µ—Ü–µ–ø—Ç (–∫–∞—Ä—Ç–æ—á–∫–∞) | `kitchen/recipe.html` |
| –†–µ–¥–∞–∫—Ç–æ—Ä —Ä–µ—Ü–µ–ø—Ç–∞ | `kitchen/recipe-edit.html` |
| –ú–µ–Ω—é | `kitchen/menu.html` |
| –®–∞–±–ª–æ–Ω—ã –º–µ–Ω—é | `kitchen/menu-templates.html` |
| –ü—Ä–æ–¥—É–∫—Ç—ã | `kitchen/products.html` |
| –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–∫—É—Ö–Ω—è) | `kitchen/dictionaries.html` |

### stock/ (–°–∫–ª–∞–¥)
| –¢–µ—Ä–º–∏–Ω | –§–∞–π–ª |
|--------|------|
| –°–∫–ª–∞–¥ / –û—Å—Ç–∞—Ç–∫–∏ | `stock/stock.html` |
| –ó–∞—è–≤–∫–∏ | `stock/requests.html` |
| –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ | `stock/receive.html` |
| –í—ã–¥–∞—á–∞ / –û—Ç–ø—É—Å–∫ | `stock/issue.html` |
| –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è | `stock/inventory.html` |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫–ª–∞–¥–∞ | `stock/stock-settings.html` |

### ashram/ (–ê—à—Ä–∞–º)
| –¢–µ—Ä–º–∏–Ω | –§–∞–π–ª |
|--------|------|
| –†–µ—Ç—Ä–∏—Ç—ã | `ashram/retreats.html` |
| –ü—Ä–∞–∑–¥–Ω–∏–∫–∏ | `ashram/festivals.html` |

### settings/ (–ù–∞—Å—Ç—Ä–æ–π–∫–∏)
| –¢–µ—Ä–º–∏–Ω | –§–∞–π–ª |
|--------|------|
| –ü–µ—Ä–µ–≤–æ–¥—ã | `settings/translations.html` |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | `settings/user-management.html` |

### –ö–æ—Ä–µ–Ω—å
| –¢–µ—Ä–º–∏–Ω | –§–∞–π–ª | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|------|-------------|
| –ì–ª–∞–≤–Ω–∞—è | `index.html` | –ë–µ–∑ header/footer, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤, CSS columns –¥–ª—è –º–µ–Ω—é |
| –õ–æ–≥–∏–Ω | `login.html` | |

## View/Edit Mode Pattern

–°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª–µ–π (person.html) –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ç—Ç–µ—Ä–Ω view/edit:
```html
<div id="profileContainer" class="view-mode">
    <span class="view-only">–ó–Ω–∞—á–µ–Ω–∏–µ</span>
    <input class="edit-only" value="...">
</div>
```

```css
.view-mode .edit-only { display: none; }
.edit-mode .view-only { display: none; }
```

```javascript
function enterEditMode() {
    document.getElementById('profileContainer').classList.replace('view-mode', 'edit-mode');
}
```

## Auto-Resizing Textarea Pattern

–î–ª—è textarea, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å—Å—è –ø–æ –≤—ã—Å–æ—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:

```html
<textarea
    class="textarea textarea-xs textarea-bordered w-full auto-resize-textarea"
    rows="1"
    oninput="autoResizeTextarea(this)"
    onchange="saveData(this.value)"></textarea>
```

```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –≤—ã—Å–æ—Ç—ã textarea
function autoResizeTextarea(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = textarea.scrollHeight + 'px';
}

// –í—ã–∑–≤–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö textarea –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
setTimeout(() => {
    document.querySelectorAll('.auto-resize-textarea').forEach(textarea => {
        autoResizeTextarea(textarea);
    });
}, 0);
```

## Color Status Indicators

–ü–∞—Ç—Ç–µ—Ä–Ω —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ preliminary.html):

```javascript
// –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —è—á–µ–µ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
const buildingId = resident?.building_id;
const roomId = resident?.room_id;

// –ó–µ–ª–µ–Ω—ã–π - –∑–∞—Å–µ–ª–µ–Ω, –∫—Ä–∞—Å–Ω—ã–π - —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ, –±–µ–∑ —Ü–≤–µ—Ç–∞ - –Ω–µ –∑–∞—Å–µ–ª–µ–Ω
const cellClass = buildingId === 'self'
    ? 'bg-error/20'
    : (buildingId && roomId) ? 'bg-success/20' : '';
```

```html
<!-- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ —è—á–µ–π–∫–∞–º -->
<td class="${cellClass}">...</td>
```

**–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:**
- üü¢ `bg-success/20` ‚Äî —É—Å–ø–µ—à–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–≥–æ—Å—Ç—å –∑–∞—Å–µ–ª–µ–Ω)
- üî¥ `bg-error/20` ‚Äî –ø—Ä–æ–±–ª–µ–º–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ)
- ‚ö™ –ë–µ–∑ —Ü–≤–µ—Ç–∞ ‚Äî –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–µ –∑–∞—Å–µ–ª–µ–Ω)
- üü° `bg-warning/30` ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

## Special Sorting Logic

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å –≤—ã–Ω–æ—Å–æ–º –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è):

```javascript
if (sortField === 'notes') {
    const aNotes = getLocalNotes(a.id);
    const bNotes = getLocalNotes(b.id);

    // –ï—Å–ª–∏ –æ–±–∞ –ø—É—Å—Ç—ã–µ - –Ω–µ –º–µ–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫
    if (!aNotes && !bNotes) return 0;
    // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ a –ø—É—Å—Ç–æ–µ - –æ–Ω–æ –≤—Å–µ–≥–¥–∞ –≤ –∫–æ–Ω–µ—Ü
    if (!aNotes) return 1;
    // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ b –ø—É—Å—Ç–æ–µ - –æ–Ω–æ –≤—Å–µ–≥–¥–∞ –≤ –∫–æ–Ω–µ—Ü
    if (!bNotes) return -1;

    // –û–±–∞ –Ω–µ –ø—É—Å—Ç—ã–µ - —Å–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ
    aVal = aNotes.toLowerCase();
    bVal = bNotes.toLowerCase();
}
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚Üë asc: 1, 2, 3, ... –ø—É—Å—Ç—ã–µ
- ‚Üì desc: 3, 2, 1, ... –ø—É—Å—Ç—ã–µ

## Transfers System (arrivals.html, departures.html, transfers.html)

–°—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–µ–∑–¥–æ–≤, –≤—ã–µ–∑–¥–æ–≤ –∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `guest_transfers`:
- `direction` ‚Äî 'arrival' –∏–ª–∏ 'departure'
- `flight_datetime` ‚Äî –≤—Ä–µ–º—è –ø—Ä–∏–ª–µ—Ç–∞/–≤—ã–ª–µ—Ç–∞
- `needs_transfer` ‚Äî 'yes'/'no' (–Ω—É–∂–µ–Ω —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä)
- `taxi_status` ‚Äî 'ordered' (—Ç–∞–∫—Å–∏ –∑–∞–∫–∞–∑–∞–Ω–æ) –∏–ª–∏ NULL
- `taxi_driver_info` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–¥–∏—Ç–µ–ª–µ (—Ç–µ–∫—Å—Ç)
- `taxi_ordered_by` ‚Äî –∫—Ç–æ –∑–∞–∫–∞–∑–∞–ª (–∏–º—è)

**–ë–µ–π–¥–∂–∏ —Å—Ç–∞—Ç—É—Å–∞:**
- üü° –ñ–µ–ª—Ç—ã–π `badge-warning` ‚Äî –Ω—É–∂–µ–Ω —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä, –Ω–æ —Ç–∞–∫—Å–∏ –Ω–µ –∑–∞–∫–∞–∑–∞–Ω–æ
- üü¢ –ó–µ–ª–µ–Ω—ã–π `badge-success` ‚Äî —Ç–∞–∫—Å–∏ –∑–∞–∫–∞–∑–∞–Ω–æ (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º)

**–ö–æ–ª–æ–Ω–∫–∏:**
- `arrivals.html`: "–ü—Ä–∏–ª–µ—Ç" (–≤—Ä–µ–º—è + –±–µ–π–¥–∂ —Ç–∞–∫—Å–∏), "–ü—Ä–∏–µ–¥–µ—Ç ‚âà" (—Ä–∞—Å—á–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏–µ–∑–¥–∞ –≤ –∞—à—Ä–∞–º = –ø—Ä–∏–ª–µ—Ç + 4 —á–∞—Å–∞)
- `departures.html`: "–í—ã–µ–∑–¥" (–≤—Ä–µ–º—è –≤—ã–µ–∑–¥–∞ = –≤—ã–ª–µ—Ç - 7 —á–∞—Å–æ–≤ + –±–µ–π–¥–∂ —Ç–∞–∫—Å–∏), "–í—ã–ª–µ—Ç" (–≤—Ä–µ–º—è –≤—ã–ª–µ—Ç–∞)

**–ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è:**
- üü¢ `bg-success/20` ‚Äî –≥–æ—Å—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω –≤ –∞—à—Ä–∞–º–µ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–¥–∞–Ω–∏–µ –∏ –∫–æ–º–Ω–∞—Ç—É)
- üî¥ `bg-error/20` ‚Äî —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ (room_id = NULL)

**–ú–æ–¥–∞–ª–∫–∏ —Ç–∞–∫—Å–∏:**
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–µ–ª–µ–Ω—ã–π –±–µ–π–¥–∂ "–ó–∞–∫–∞–∑–∞–Ω–æ" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ü–æ–ª—è: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–¥–∏—Ç–µ–ª–µ (textarea), –∫—Ç–æ –∑–∞–∫–∞–∑–∞–ª (input)
- –ö–Ω–æ–ø–∫–∏: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å, –û—Ç–º–µ–Ω–∏—Ç—å —Ç–∞–∫—Å–∏
- –ö—Ä–µ—Å—Ç–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É (–±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–ó–∞–∫—Ä—ã—Ç—å")

## CSV Import (retreat-guests.html)

–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–æ—Å—Ç–µ–π —Ä–µ—Ç—Ä–∏—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–º–ø–æ—Ä—Ç –∏–∑ CSV —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º:
- –ü–∞—Ä—Å–∏–Ω–≥–æ–º –¥–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö: `"7 —Ñ–µ–≤—Ä–∞–ª—è 18:30"`, `"22.02.26 5:50"`, `"06.02.2026 –≤ 04.05"`, `"07.03.2026"`, `"7 —Ñ–µ–≤—Ä–∞–ª—è"`
- –ú–∞—Ç—á–∏–Ω–≥–æ–º –ø–æ email (+5), —Ç–µ–ª–µ—Ñ–æ–Ω—É (+4), –¥—É—Ö–æ–≤–Ω–æ–º—É –∏–º–µ–Ω–∏ (+3), telegram (+3)
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ score 3-4 (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä)

–ö–æ–ª–æ–Ω–∫–∏ CSV: `name`, `name2` (–¥—É—Ö–æ–≤–Ω–æ–µ –∏–º—è), `phone`, `email`, `birth`, `country`, `arrival_time`, `departure_time`, `transfer_up_2`, `transfer_back`, `hotel`, `famili`, `Questions`.

### –ü—Ä–∞–≤–∏–ª–∞ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª–µ–π

**–î—É—Ö–æ–≤–Ω–æ–µ –∏–º—è** (`name2`) ‚Äî –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ: `–Ω–µ—Ç`, `–ø–æ–∫–∞ –Ω–µ—Ç`, `–µ—â–µ –Ω–µ—Ç`, `–µ—â—ë –Ω–µ—Ç`, `-`, `‚Äì`, `no` ‚Äî –ø–æ–ª–µ –æ—á–∏—â–∞–µ—Ç—Å—è (–æ—Å—Ç–∞—ë—Ç—Å—è –ø—É—Å—Ç—ã–º).

**–°—Ç—Ä–∞–Ω–∞ –∏ –≥–æ—Ä–æ–¥** (`country`) ‚Äî –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –≤–º–µ—Å—Ç–µ, —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ –¥–≤–∞ –ø–æ–ª—è:
- `"–õ–∞—Ç–≤–∏—è, –†–∏–≥–∞"` ‚Üí —Å—Ç—Ä–∞–Ω–∞: –õ–∞—Ç–≤–∏—è, –≥–æ—Ä–æ–¥: –†–∏–≥–∞
- `"–†–æ—Å—Å–∏—è –ò—Ä–∫—É—Ç—Å–∫"` ‚Üí —Å—Ç—Ä–∞–Ω–∞: –†–æ—Å—Å–∏—è, –≥–æ—Ä–æ–¥: –ò—Ä–∫—É—Ç—Å–∫
- –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–†–æ—Å—Å–∏—è, –£–∫—Ä–∞–∏–Ω–∞, –õ–∞—Ç–≤–∏—è, –∏ —Ç.–¥.)

## Guest Portal (guest-portal/)

–û—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å ‚Äî –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è –≥–æ—Å—Ç–µ–π –∞—à—Ä–∞–º–∞. –î–∏–∑–∞–π–Ω –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**URL:** https://in.rupaseva.com/guest-portal/

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Tailwind CSS** (CDN, –±–µ–∑ DaisyUI)
- **Supabase** (—Ç–∞ –∂–µ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- Vanilla JS

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
guest-portal/
‚îú‚îÄ‚îÄ index.html          # Dashboard (–ø—Ä–æ—Ñ–∏–ª—å + —Ä–µ—Ç—Ä–∏—Ç + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã)
‚îú‚îÄ‚îÄ login.html          # –í—Ö–æ–¥ –¥–ª—è –≥–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ contacts.html       # –ö–æ–Ω—Ç–∞–∫—Ç—ã –∞—à—Ä–∞–º–∞
‚îú‚îÄ‚îÄ materials.html      # –ì–∞–π–¥—ã –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
‚îú‚îÄ‚îÄ retreats.html       # –ò—Å—Ç–æ—Ä–∏—è —Ä–µ—Ç—Ä–∏—Ç–æ–≤
‚îú‚îÄ‚îÄ css/portal.css      # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îî‚îÄ‚îÄ js/
    ‚îú‚îÄ‚îÄ portal-config.js    # Supabase credentials
    ‚îú‚îÄ‚îÄ portal-auth.js      # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≥–æ—Å—Ç–µ–π
    ‚îú‚îÄ‚îÄ portal-layout.js    # Header/Footer/i18n
    ‚îî‚îÄ‚îÄ portal-data.js      # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–ü—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π** ‚Äî `index.html?view=<vaishnava_id>`
   - –•–µ–¥–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–æ–≥–æ
   - –°–∫—Ä—ã—Ç—ã –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

2. **–†–∞—Å—á—ë—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ñ–∏–ª—è**:
   ```javascript
   // –ü–æ–ª—è: firstName, spiritualName, phone, telegram, country, city, photoUrl, birthDate
   // + spiritualTeacher (–∏–ª–∏ noSpiritualTeacher = true)
   // –¶–≤–µ—Ç–∞: <50% –∫—Ä–∞—Å–Ω—ã–π, 50-99% –∂—ë–ª—Ç—ã–π, 100% –∑–µ–ª—ë–Ω—ã–π
   ```

3. **–ß–µ–∫–±–æ–∫—Å "–ü–æ–∫–∞ –Ω–µ—Ç"** –¥–ª—è –¥—É—Ö–æ–≤–Ω–æ–≥–æ —É—á–∏—Ç–µ–ª—è ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª–µ –∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ

4. **Inline —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤** ‚Äî view/edit —Ä–µ–∂–∏–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (portal-auth.js)

```javascript
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
window.currentGuest = {
    id, authId, email, firstName, lastName, spiritualName,
    phone, telegram, country, city, photoUrl,
    spiritualTeacher, noSpiritualTeacher, birthDate,
    userType, isStaff, isProfilePublic
};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
const guest = await PortalAuth.checkGuestAuth();  // —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ login –µ—Å–ª–∏ –Ω–µ—Ç —Å–µ—Å—Å–∏–∏
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)

```sql
-- vaishnavas
no_spiritual_teacher BOOLEAN DEFAULT FALSE  -- —Ñ–ª–∞–≥ "–ü–æ–∫–∞ –Ω–µ—Ç –¥—É—Ö–æ–≤–Ω–æ–≥–æ —É—á–∏—Ç–µ–ª—è"
is_profile_public BOOLEAN DEFAULT TRUE      -- –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è
```

## Documentation

- **PRODUCT.md** ‚Äî –æ–±–∑–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞ (—á–∞—Å—Ç–∏—á–Ω–æ —É—Å—Ç–∞—Ä–µ–ª)
- **docs/guests-plan.md** ‚Äî –ø–ª–∞–Ω –º–æ–¥—É–ª—è –≥–æ—Å—Ç–µ–π
