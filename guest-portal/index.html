<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кабинет гостя — ШРСК</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Portal CSS -->
    <link rel="stylesheet" href="css/portal.css">
    <!-- Cropper.js для редактирования фото -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.css">
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'srsk-green': '#147D30',
                        'srsk-orange': '#FFBA47',
                        'srsk-bg': '#F5F3EF',
                    },
                    fontFamily: {
                        'sans': ['Noto Sans', 'Noto Sans Devanagari', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Noto Sans', 'Noto Sans Devanagari', sans-serif;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
        }
        .card-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #999;
            margin-bottom: 12px;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-srsk-bg min-h-screen">

    <!-- Шапка -->
    <header class="bg-srsk-green">
        <div class="max-w-6xl mx-auto px-4 md:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">

                <!-- Логотип -->
                <a href="#" class="flex items-center">
                    <svg class="h-10" viewBox="0 0 308.75 98.28">
                        <path fill="#FFBA47" d="M143.64,4.26h-4.62v24.95c0,1.89.04,3.53-.27,4.87-.31,1.36-.79,2.43-1.45,3.22-.61.86-1.48,1.47-2.59,1.84-.73.3-1.55.49-2.47.56-.31.06-.61.1-.92.1h-.19c-1.16-.06-2.2-.25-3.12-.56-1.16-.37-2.14-.95-2.93-1.75-.81-.86-1.39-1.96-1.74-3.32-.37-1.34-.56-3-.56-4.96V4.26h-4.6v27.15c0,4.17,1.16,7.29,3.49,9.37,1.16,1.05,2.61,1.82,4.33,2.3.36.13.78.23,1.28.29-4.23,1.53-7.11,3.62-8.65,6.25-2.15,3.24-2.21,7.35-.19,12.33l12.59,30.6,12.16-30.6c1.95-4.97,1.89-9.08-.19-12.33-1.47-2.58-4.25-4.63-8.36-6.15.49-.13.97-.26,1.45-.39,1.6-.48,2.95-1.28,4.04-2.37,1.16-1.11,2.03-2.49,2.59-4.14.61-1.71.92-3.74.92-6.08V4.26M139.21,51.92c1.23,2.21,1.17,5-.17,8.36l-8.02,20.76-8.45-20.76c-1.4-3.36-1.46-6.14-.17-8.36,1.41-2.28,4.19-3.96,8.36-5.06,4.17,1.1,6.98,2.79,8.45,5.06"/>
                        <path fill="#fff" d="M26.44,33.99c0-1.56-.46-2.83-1.39-3.81-.93-.98-2.09-1.86-3.48-2.62-1.39-.76-2.91-1.48-4.54-2.14-1.63-.67-3.15-1.48-4.54-2.42-1.39-.95-2.55-2.12-3.48-3.51-.93-1.39-1.39-3.17-1.39-5.32,0-3.05,1.06-5.46,3.18-7.24,2.12-1.78,5.12-2.67,9.02-2.67,2.26,0,4.33.17,6.18.5,1.86.34,3.3.76,4.35,1.28l-1.39,4.12c-.85-.42-2.11-.82-3.76-1.21-1.65-.38-3.52-.58-5.6-.58-2.45,0-4.29.55-5.52,1.64-1.22,1.1-1.84,2.39-1.84,3.87s.46,2.66,1.39,3.62c.93.96,2.09,1.83,3.48,2.59,1.39.76,2.91,1.51,4.54,2.26,1.63.74,3.15,1.61,4.54,2.59,1.39.98,2.55,2.16,3.48,3.54.93,1.38,1.39,3.08,1.39,5.12,0,1.67-.3,3.18-.89,4.51-.59,1.34-1.47,2.49-2.62,3.46-1.15.97-2.54,1.71-4.18,2.23-1.64.52-3.49.78-5.57.78-2.79,0-5.09-.21-6.91-.64-1.82-.43-3.23-.9-4.23-1.42l1.56-4.12c.85.47,2.12.93,3.79,1.38,1.67.45,3.55.68,5.63.68,1.23,0,2.38-.12,3.45-.36,1.08-.24,2.01-.63,2.79-1.17.78-.54,1.4-1.22,1.87-2.03.46-.82.7-1.78.7-2.9"/>
                        <rect fill="#fff" x="63.63" y="4.91" width="4.62" height="38.99"/>
                        <path fill="#fff" d="M89.54,5.25c1.41-.26,3.04-.46,4.87-.61,1.84-.15,3.52-.22,5.04-.22,1.71,0,3.33.19,4.87.56,1.54.37,2.9.98,4.07,1.84,1.17.86,2.11,1.97,2.81,3.34s1.06,3.05,1.06,5.01c0,3.04-.84,5.51-2.51,7.41-1.67,1.89-2.76,2.86-5.32,3.49l10.86,17.79h-5.4l-10.27-16.82h-5.46s0,16.82,0,16.82h-4.62V5.25ZM99.57,8.43h-1.5c-.52,0-1.02.02-1.5.06-.48.04-.94.08-1.37.11-.43.04-.77.09-1.03.17v14.37h4.34c2.56,0,4.68-.63,6.35-1.89,1.67-1.26,2.51-3.23,2.51-5.9,0-2.01-.69-3.66-2.06-4.96-1.37-1.3-3.29-1.95-5.74-1.95"/>
                        <path fill="#fff" d="M150.26,5.25c1.41-.33,2.93-.56,4.57-.67,1.63-.11,3.25-.17,4.85-.17,1.71,0,3.44.17,5.21.5,1.76.33,3.37.95,4.82,1.84,1.45.89,2.63,2.12,3.54,3.68.91,1.56,1.36,3.55,1.36,5.96s-.43,4.38-1.28,6.02c-.86,1.64-1.99,2.96-3.4,3.98-1.41,1.02-3.03,1.75-4.85,2.2-1.82.45-3.7.67-5.63.67h-.92c-.43,0-.87,0-1.34-.03-.46-.02-.92-.05-1.37-.08-.45-.04-.76-.07-.95-.11v14.82h-4.62V5.25ZM159.78,8.43c-.97,0-1.89.02-2.79.06-.89.04-1.6.13-2.12.28v16.16c.19.08.48.12.89.14.41.02.84.04,1.28.06.45.02.87.03,1.28.03h.89c1.26,0,2.52-.12,3.76-.36,1.24-.24,2.37-.68,3.37-1.31,1-.63,1.81-1.52,2.42-2.67.61-1.15.92-2.62.92-4.4,0-1.52-.29-2.79-.86-3.81-.58-1.02-1.34-1.84-2.28-2.45-.95-.61-2.01-1.05-3.2-1.31-1.19-.26-2.37-.39-3.56-.39"/>
                        <path fill="#fff" d="M80.84,80.79c0-1.56-.46-2.83-1.39-3.82-.93-.98-2.09-1.86-3.48-2.62-1.39-.76-2.91-1.48-4.54-2.15-1.63-.67-3.15-1.47-4.54-2.42-1.39-.95-2.55-2.12-3.48-3.51-.93-1.39-1.39-3.17-1.39-5.32,0-3.04,1.06-5.46,3.18-7.24,2.12-1.78,5.12-2.67,9.02-2.67,2.26,0,4.33.17,6.18.5,1.86.33,3.3.76,4.35,1.28l-1.39,4.12c-.85-.42-2.11-.82-3.76-1.21-1.65-.38-3.52-.58-5.6-.58-2.45,0-4.29.55-5.52,1.64-1.22,1.1-1.84,2.39-1.84,3.87s.46,2.66,1.39,3.62c.93.97,2.09,1.83,3.48,2.59,1.39.76,2.91,1.51,4.54,2.26,1.63.74,3.15,1.61,4.54,2.59,1.39.98,2.55,2.16,3.48,3.54.93,1.38,1.39,3.08,1.39,5.12,0,1.67-.3,3.18-.89,4.51-.59,1.34-1.47,2.49-2.62,3.45-1.15.97-2.54,1.71-4.18,2.23-1.64.52-3.49.78-5.57.78-2.79,0-5.09-.21-6.91-.64-1.82-.43-3.23-.9-4.23-1.42l1.56-4.12c.85.47,2.12.93,3.79,1.38,1.67.45,3.55.68,5.63.68,1.23,0,2.38-.12,3.45-.36,1.08-.24,2.01-.63,2.79-1.17.78-.54,1.4-1.22,1.87-2.03.46-.82.7-1.78.7-2.9"/>
                        <polygon fill="#fff" points="89.42 51.71 111.13 51.71 111.13 55.84 94.05 55.84 94.05 68.59 109.25 68.59 109.25 72.72 94.05 72.72 94.05 86.59 112.38 86.59 112.38 90.71 89.42 90.71 89.42 51.71"/>
                        <polygon fill="#fff" points="195.8 72.33 195.61 72.33 195.61 90.38 190.98 90.38 190.98 51.39 195.61 51.39 195.61 68.77 195.69 68.77 211.2 51.39 216.55 51.39 199.62 69.92 217.8 90.38 212.43 90.38 195.8 72.33"/>
                        <path fill="#fff" d="M291.04,51.39h4.62v30.42c0,2.97-.66,5.24-1.98,6.8-1.32,1.56-3.31,2.34-5.99,2.34-.3,0-.67-.02-1.11-.06-.45-.04-.89-.09-1.34-.17-.45-.08-.88-.17-1.31-.28-.43-.11-.77-.24-1.03-.39l.89-3.9c1.04.45,2.17.67,3.4.67,1.56,0,2.59-.55,3.09-1.64.5-1.09.75-2.59.75-4.48v-29.3Z"/>
                        <path fill="#fff" d="M158.1,51.1h-2.12l-14.76,39.61h4.62l3.88-10.81h14.3l3.99,10.81h4.9l-14.82-39.61ZM151.22,75.89l5.71-15.69,5.71,15.69h-11.42Z"/>
                        <path fill="#fff" d="M188.73,4.25h-2.12l-14.76,39.61h4.62l3.88-10.81h14.3l3.99,10.81h4.9l-14.82-39.61ZM181.86,29.04l5.71-15.69,5.71,15.69h-11.42Z"/>
                        <path fill="#fff" d="M35.03,5.3c1.41-.26,3.04-.46,4.87-.61,1.84-.15,3.52-.22,5.04-.22,1.71,0,3.33.19,4.87.56,1.54.37,2.9.98,4.07,1.84,1.17.85,2.11,1.97,2.81,3.34s1.06,3.04,1.06,5.01c0,3.05-.84,5.52-2.51,7.41-1.67,1.89-2.76,2.86-5.32,3.49l10.86,17.79h-5.4l-10.27-16.82h-5.46s0,16.82,0,16.82h-4.62V5.3ZM45.05,8.47h-1.5c-.52,0-1.02.02-1.5.06-.48.04-.94.08-1.37.11-.43.04-.77.09-1.03.17v14.37h4.34c2.56,0,4.68-.63,6.35-1.89,1.67-1.26,2.51-3.23,2.51-5.91,0-2-.69-3.66-2.06-4.96-1.37-1.3-3.29-1.95-5.74-1.95"/>
                        <polygon fill="#fff" points="274.27 51.39 274.27 76.79 274.27 80.33 253.05 50.78 250.6 50.78 250.6 90.38 254.94 90.38 254.94 61.19 276.17 91 278.62 91 278.62 51.39 274.27 51.39"/>
                        <path fill="#fff" d="M241.51,51.39h-1.05v24.73c0,2,.08,3.83-.31,5.19-.19.65-.29,1.04-.57,1.57-.33.53-.67,1-.98,1.41-.05.07-.11.13-.16.19-.77.79-1.71,1.37-2.84,1.73-1.09.35-1.93.53-3.29.55-1.37-.02-2.21-.21-3.3-.55-1.13-.36-2.07-.94-2.84-1.73-.05-.06-.11-.13-.16-.19-.16-.21-.35-.43-.54-.67-.48-.7-.68-1.14-.96-2.11-.39-1.36-.31-3.28-.31-5.38v-24.73h-4.6v26.91c0,4.23,1.17,7.39,3.51,9.47,1.81,1.61,3.71,2.59,6.6,2.95.7.11,1.45.16,2.33.16.09,0,.17,0,.26,0,.09,0,.17,0,.26,0,.88,0,1.62-.06,2.33-.16,2.89-.37,4.8-1.35,6.6-2.95,2.34-2.08,3.51-5.24,3.51-9.47v-26.91h-3.49Z"/>
                    </svg>
                </a>

                <!-- Меню (десктоп) -->
                <nav class="hidden md:flex items-center gap-6">
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium uppercase tracking-wide">Профиль</a>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium uppercase tracking-wide">Ретриты</a>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium uppercase tracking-wide">Материалы</a>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium uppercase tracking-wide">Галерея</a>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium uppercase tracking-wide">Контакты</a>

                    <!-- Разделитель -->
                    <div class="w-px h-6 bg-white/20"></div>

                    <!-- Аватар + Имя -->
                    <a href="profile.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
                        <div id="header-photo" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center overflow-hidden">
                            <svg class="w-4 h-4 text-white/70" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                            </svg>
                        </div>
                        <span id="header-name" class="text-white/90 text-sm"></span>
                    </a>

                    <!-- Выход -->
                    <button onclick="PortalAuth.logout()" class="text-white/60 hover:text-white transition-colors" title="Выйти">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                        </svg>
                    </button>
                </nav>

                <!-- Мобайл: аватар + бургер -->
                <div class="md:hidden flex items-center gap-3">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4 text-white/70" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                        </svg>
                    </div>
                    <button class="text-white p-2" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Мобильное меню -->
            <nav id="mobile-menu" class="hidden md:hidden pb-4">
                <div class="flex flex-col gap-4">
                    <div id="mobile-name" class="text-white/90 text-sm font-medium py-2 border-b border-white/10 mb-1"></div>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium py-2 uppercase tracking-wide">Профиль</a>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium py-2 uppercase tracking-wide">Ретриты</a>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium py-2 uppercase tracking-wide">Материалы</a>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium py-2 uppercase tracking-wide">Галерея</a>
                    <a href="#" class="text-white/90 hover:text-srsk-orange transition-colors text-base font-medium py-2 uppercase tracking-wide">Контакты</a>
                    <button onclick="PortalAuth.logout()" class="text-white/60 hover:text-white transition-colors text-base font-medium py-2 mt-2 border-t border-white/10 pt-4 flex items-center gap-2 uppercase tracking-wide w-full">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                        </svg>
                        Выйти
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <main class="p-4 md:p-6 lg:p-8">
    <div class="max-w-6xl mx-auto">

        <!-- Верхняя часть: Профиль + (Ретрит + Трансфер) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">

            <!-- Профиль (зелёный) -->
            <div class="card md:col-span-1 text-white" style="background: #147D30;">

                <!-- === РЕЖИМ ПРОСМОТРА === -->
                <div id="profile-view" class="flex flex-col items-center text-center">
                    <!-- Круглое фото -->
                    <div id="profile-photo" onclick="openPhotoModal()" class="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mb-4 overflow-hidden ring-[5px] ring-srsk-orange cursor-pointer hover:ring-white transition-all">
                        <svg class="w-12 h-12 text-white/60" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                        </svg>
                    </div>

                    <!-- Имена -->
                    <div id="profile-spiritual-name" class="font-semibold text-xl"></div>
                    <div id="profile-civil-name" class="text-sm text-white/70"></div>

                    <!-- Страна и город -->
                    <div id="profile-location" class="flex items-center justify-center gap-1.5 mt-2 text-sm text-white/70">
                        <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                        </svg>
                        <span></span>
                    </div>

                    <!-- Дата рождения и духовный учитель -->
                    <div class="mt-3 text-sm text-white/70 space-y-1">
                        <div id="profile-birthdate" class="flex items-center justify-center gap-1.5">
                            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8.25v-1.5m0 1.5c-1.355 0-2.697.056-4.024.166C6.845 8.51 6 9.473 6 10.608v2.513m6-4.87c1.355 0 2.697.055 4.024.165C17.155 8.51 18 9.473 18 10.608v2.513m-3-4.87v-1.5m-6 1.5v-1.5m12 9.75l-1.5.75a3.354 3.354 0 01-3 0 3.354 3.354 0 00-3 0 3.354 3.354 0 01-3 0 3.354 3.354 0 00-3 0 3.354 3.354 0 01-3 0L3 16.5m15-3.38a48.474 48.474 0 00-6-.37c-2.032 0-4.034.125-6 .37m12 0c.39.049.777.102 1.163.16 1.07.16 1.837 1.094 1.837 2.175v5.17c0 .62-.504 1.124-1.125 1.124H4.125A1.125 1.125 0 013 20.625v-5.17c0-1.08.768-2.014 1.837-2.174A47.78 47.78 0 016 13.12M12.265 3.11a.375.375 0 11-.53 0L12 2.845l.265.265zm-3 0a.375.375 0 11-.53 0L9 2.845l.265.265zm6 0a.375.375 0 11-.53 0L15 2.845l.265.265z" />
                            </svg>
                            <span></span>
                        </div>
                        <div id="profile-teacher" class="flex items-center justify-center gap-1.5">
                            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 122.03 312.54" fill="currentColor">
                                <path d="M102,15.99h-15.18v81.89c0,6.21.12,11.58-.88,15.98-1.01,4.45-2.6,7.98-4.77,10.58-2.02,2.81-4.85,4.83-8.51,6.05-2.38,1-5.08,1.62-8.1,1.83-1.01.21-2.02.32-3.02.32h-.64c-3.81-.21-7.23-.83-10.25-1.83-3.81-1.22-7.02-3.13-9.62-5.73-2.65-2.81-4.56-6.44-5.73-10.89-1.22-4.4-1.83-9.83-1.83-16.3V15.99h-15.1v89.12c0,13.68,3.81,23.94,11.45,30.77,3.81,3.44,8.56,5.96,14.23,7.55,1.17.42,2.57.74,4.21.96-13.89,5.03-23.35,11.87-28.38,20.51-7.05,10.65-7.26,24.14-.64,40.46l41.34,100.45,39.91-100.45c6.41-16.32,6.2-29.82-.64-40.46-4.82-8.48-13.97-15.21-27.43-20.2,1.59-.43,3.18-.85,4.77-1.27,5.25-1.59,9.67-4.19,13.27-7.79,3.82-3.66,6.65-8.18,8.51-13.59,2.02-5.62,3.02-12.27,3.02-19.95V15.99M87.45,172.46c4.03,7.26,3.84,16.4-.56,27.43l-26.31,68.13-27.75-68.13c-4.61-11.03-4.8-20.17-.55-27.43,4.61-7.47,13.76-13.01,27.43-16.62,13.67,3.61,22.93,9.15,27.75,16.62"/>
                            </svg>
                            <span></span>
                        </div>
                    </div>

                    <!-- Статус -->
                    <div id="profile-status" class="inline-block mt-3 px-4 py-1.5 bg-white/20 text-white text-sm rounded-full">
                    </div>

                    <!-- Контакты -->
                    <div class="mt-5 text-sm text-white/80 space-y-2">
                        <div id="profile-phone" class="flex items-center justify-center gap-2">
                            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                            </svg>
                            <span></span>
                        </div>
                        <a id="profile-telegram" href="#" class="flex items-center justify-center gap-2 hover:text-srsk-orange transition-colors">
                            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                            </svg>
                            <span></span>
                        </a>
                    </div>

                    <!-- Процент заполнения -->
                    <div class="mt-5 w-full">
                        <div class="flex justify-between text-xs text-white/70 mb-1.5">
                            <span>Профиль заполнен</span>
                            <span id="profile-completeness-value">0%</span>
                        </div>
                        <div class="w-full h-1.5 bg-white/20 rounded-full overflow-hidden">
                            <div id="profile-completeness-bar" class="h-full bg-srsk-orange rounded-full" style="width: 0%"></div>
                        </div>
                    </div>

                    <button onclick="toggleProfileEdit(true)" class="mt-5 text-sm hover:opacity-80 transition-opacity flex items-center gap-1" style="color: #F5BD5D;">
                        Редактировать
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" />
                        </svg>
                    </button>
                </div>

                <!-- === РЕЖИМ РЕДАКТИРОВАНИЯ === -->
                <div id="profile-edit" class="hidden">
                    <form id="profile-form" class="space-y-4">
                        <!-- Фото -->
                        <div class="flex justify-center">
                            <div class="photo-upload" id="edit-photo-upload" style="background: rgba(255,255,255,0.2);">
                                <img id="edit-photo-preview" src="" alt="" class="hidden">
                                <div id="edit-photo-placeholder" class="photo-upload-placeholder" style="background: transparent; color: rgba(255,255,255,0.6);">
                                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                    <span class="text-xs">Добавить фото</span>
                                </div>
                                <div class="photo-upload-overlay">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </div>
                                <input type="file" id="edit-photo-input" accept="image/*" class="hidden">
                            </div>
                        </div>

                        <!-- Духовное имя -->
                        <div>
                            <label class="text-xs text-white/60 uppercase tracking-wide">Духовное имя</label>
                            <input type="text" id="edit-spiritualName" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 focus:outline-none focus:border-white/40" placeholder="Например: Ананда Тиртха дас">
                        </div>

                        <!-- Имя и Фамилия -->
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-white/60 uppercase tracking-wide">Имя</label>
                                <input type="text" id="edit-firstName" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 focus:outline-none focus:border-white/40">
                            </div>
                            <div>
                                <label class="text-xs text-white/60 uppercase tracking-wide">Фамилия</label>
                                <input type="text" id="edit-lastName" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 focus:outline-none focus:border-white/40">
                            </div>
                        </div>

                        <!-- Страна и Город -->
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-white/60 uppercase tracking-wide">Страна</label>
                                <input type="text" id="edit-country" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 focus:outline-none focus:border-white/40">
                            </div>
                            <div>
                                <label class="text-xs text-white/60 uppercase tracking-wide">Город</label>
                                <input type="text" id="edit-city" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 focus:outline-none focus:border-white/40">
                            </div>
                        </div>

                        <!-- Дата рождения -->
                        <div>
                            <label class="text-xs text-white/60 uppercase tracking-wide">Дата рождения</label>
                            <input type="date" id="edit-birthDate" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-white/40">
                        </div>

                        <!-- Духовный учитель -->
                        <div>
                            <label class="text-xs text-white/60 uppercase tracking-wide">Духовный учитель</label>
                            <input type="text" id="edit-spiritualTeacher" list="teachers-list" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 focus:outline-none focus:border-white/40" autocomplete="off">
                            <datalist id="teachers-list"></datalist>
                        </div>

                        <!-- Телефон -->
                        <div>
                            <label class="text-xs text-white/60 uppercase tracking-wide">Телефон</label>
                            <input type="tel" id="edit-phone" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 focus:outline-none focus:border-white/40" placeholder="+7 999 123-45-67">
                        </div>

                        <!-- Telegram -->
                        <div>
                            <label class="text-xs text-white/60 uppercase tracking-wide">Telegram</label>
                            <input type="text" id="edit-telegram" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 focus:outline-none focus:border-white/40" placeholder="@username">
                        </div>

                        <!-- Публичность профиля -->
                        <div class="pt-2">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="edit-is-public" checked class="w-5 h-5 rounded border-white/30 bg-white/10 text-srsk-orange focus:ring-srsk-orange focus:ring-offset-0 cursor-pointer">
                                <span class="text-sm text-white/80">Сделать профиль доступным другим вайшнавам ШРСК</span>
                            </label>
                        </div>

                        <!-- Кнопки -->
                        <div class="flex gap-2 pt-2">
                            <button type="submit" id="save-profile-btn" class="flex-1 bg-white text-srsk-green font-medium py-2 px-4 rounded-lg hover:bg-white/90 transition-colors flex items-center justify-center gap-2">
                                <span>Сохранить</span>
                                <svg id="save-spinner" class="w-4 h-4 animate-spin hidden" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                                </svg>
                            </button>
                            <button type="button" onclick="toggleProfileEdit(false)" class="px-4 py-2 border border-white/30 text-white rounded-lg hover:bg-white/10 transition-colors">
                                Отмена
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Правая колонка: Ретрит + Трансфер -->
            <div class="md:col-span-2 flex flex-col gap-4">

                <!-- Текущий ретрит -->
                <div class="card cursor-pointer transition-all flex-1 p-0 overflow-hidden border-2 border-transparent hover:border-srsk-green" style="background: #E8F5E9;">
                    <div class="flex flex-col sm:flex-row h-full">
                        <!-- Картинка ретрита на всю высоту -->
                        <div class="w-full sm:w-56 h-48 sm:h-auto bg-gray-200 flex-shrink-0 flex items-center justify-center overflow-hidden">
                            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                            </svg>
                        </div>

                        <!-- Инфо -->
                        <div class="flex-1 p-5 flex flex-col">
                            <div class="card-label" style="color: #147D30;">Ваш ретрит</div>

                            <div class="text-2xl font-semibold text-gray-800">Ретрит Шри Шри Радхи-Говинды</div>
                            <div class="text-sm text-gray-500 mt-1">7 — 22 февраля 2025</div>

                            <!-- Краткое описание -->
                            <p class="text-sm text-gray-600 mt-2 line-clamp-2">
                                Фестиваль Шри Шри Радхи-Говинды — главное событие года в ашраме
                            </p>

                            <div class="mt-auto pt-4 grid grid-cols-2 gap-4">
                                <!-- Комната -->
                                <div>
                                    <div class="text-xs text-gray-400 uppercase tracking-wide">Комната</div>
                                    <div class="font-medium text-gray-800 mt-1">Гостевой дом, №12</div>
                                </div>

                                <!-- Сосед -->
                                <div>
                                    <div class="text-xs text-gray-400 uppercase tracking-wide">Сосед</div>
                                <a href="#" class="flex items-center gap-3 mt-1 hover:text-srsk-orange transition-colors">
                                        <div class="w-10 h-10 bg-white rounded-full flex-shrink-0 flex items-center justify-center">
                                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                                            </svg>
                                        </div>
                                        <div class="text-sm text-gray-700">Кришна Према дас</div>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Стрелка -->
                        <div class="hidden sm:flex items-center pr-4">
                            <svg class="w-5 h-5 text-srsk-green" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Трансфер -->
                <div class="card" style="background: #FFF3CD;">
                    <div class="card-label" style="color: #997A00;">Трансфер</div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Прилёт -->
                        <div class="p-4 bg-white/60 rounded-xl cursor-pointer border-2 border-transparent hover:border-amber-300 transition-all">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                                    </svg>
                                    Прилёт
                                </div>
                                <a href="#" class="text-xs text-srsk-orange hover:underline">Изменить</a>
                            </div>

                            <div class="text-xl font-medium text-gray-800">25 фев, 14:30</div>
                            <div class="text-sm text-gray-500">Рейс SU232, Дели</div>

                            <div class="mt-3 flex items-center gap-2">
                                <span class="w-2 h-2 bg-srsk-green rounded-full"></span>
                                <span class="text-sm text-srsk-green font-medium">Такси заказано</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                Водитель: Раджеш, +91 98765 43210
                            </div>
                        </div>

                        <!-- Вылет -->
                        <div class="p-4 bg-white/60 rounded-xl cursor-pointer border-2 border-transparent hover:border-amber-300 transition-all">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
                                    <svg class="w-4 h-4 rotate-180" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                                    </svg>
                                    Вылет
                                </div>
                                <a href="#" class="text-xs text-srsk-orange hover:underline">Изменить</a>
                            </div>

                            <div class="text-xl font-medium text-gray-800">6 мар, 19:00</div>
                            <div class="text-sm text-gray-500">Рейс SU233, Дели</div>

                            <div class="mt-3 flex items-center gap-2">
                                <span class="w-2 h-2 bg-srsk-orange rounded-full"></span>
                                <span class="text-sm text-yellow-700 font-medium">Такси нужно — ожидает</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Ближайшие ретриты -->
        <div class="card mb-4" style="background: #E8E0F0;">
            <div class="flex items-center justify-between mb-4">
                <div class="card-label mb-0" style="color: #6B5B95;">Ближайшие ретриты</div>
                <a href="retreats.html" class="text-sm font-medium hover:underline flex items-center gap-1" style="color: #E8900C;">
                    Все ретриты
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                    </svg>
                </a>
            </div>

            <div id="upcoming-retreats" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <!-- Спиннер загрузки -->
                <div class="col-span-3 flex justify-center py-8">
                    <svg class="w-8 h-8 animate-spin text-[#6B5B95]" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Путеводитель -->
        <div class="card mb-4 cursor-pointer" style="background: #FFF3CD;" onclick="showComingSoon()">
            <div class="flex items-center justify-between mb-4">
                <div class="card-label mb-0" style="color: #997A00;">Материалы</div>
                <a href="#" class="text-sm font-medium hover:underline flex items-center gap-1" style="color: #E8900C;">
                    Все материалы
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                    </svg>
                </a>
            </div>

            <div class="flex gap-3 overflow-x-auto hide-scrollbar pb-2">
                <!-- Карточка 1 -->
                <div class="flex-shrink-0 w-[172px] bg-gray-50 rounded-xl p-4 cursor-pointer border-2 border-transparent hover:border-amber-300 transition-all">
                    <svg class="w-8 h-8 text-gray-600 mb-3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                    </svg>
                    <div class="font-medium text-gray-800">Как добраться</div>
                    <div class="text-xs text-gray-500 mt-1">Маршруты из аэропортов</div>
                </div>

                <!-- Карточка 2 -->
                <div class="flex-shrink-0 w-[172px] bg-gray-50 rounded-xl p-4 cursor-pointer border-2 border-transparent hover:border-amber-300 transition-all">
                    <svg class="w-8 h-8 text-gray-600 mb-3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                    </svg>
                    <div class="font-medium text-gray-800">Правила ашрама</div>
                    <div class="text-xs text-gray-500 mt-1">Распорядок дня</div>
                </div>

                <!-- Карточка 3 -->
                <div class="flex-shrink-0 w-[172px] bg-gray-50 rounded-xl p-4 cursor-pointer border-2 border-transparent hover:border-amber-300 transition-all">
                    <svg class="w-8 h-8 text-gray-600 mb-3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0M12 12.75h.008v.008H12v-.008z" />
                    </svg>
                    <div class="font-medium text-gray-800">Что взять с собой</div>
                    <div class="text-xs text-gray-500 mt-1">Список вещей</div>
                </div>

                <!-- Карточка 4 -->
                <div class="flex-shrink-0 w-[172px] bg-gray-50 rounded-xl p-4 cursor-pointer border-2 border-transparent hover:border-amber-300 transition-all">
                    <svg class="w-8 h-8 text-gray-600 mb-3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z" />
                    </svg>
                    <div class="font-medium text-gray-800">Карта ашрама</div>
                    <div class="text-xs text-gray-500 mt-1">Интерактивная</div>
                </div>

                <!-- Карточка 5 -->
                <div class="flex-shrink-0 w-[172px] bg-gray-50 rounded-xl p-4 cursor-pointer border-2 border-transparent hover:border-amber-300 transition-all">
                    <svg class="w-8 h-8 text-gray-600 mb-3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                    </svg>
                    <div class="font-medium text-gray-800">Виза и деньги</div>
                    <div class="text-xs text-gray-500 mt-1">Полезные советы</div>
                </div>

                <!-- Карточка 6 -->
                <div class="flex-shrink-0 w-[172px] bg-gray-50 rounded-xl p-4 cursor-pointer border-2 border-transparent hover:border-amber-300 transition-all">
                    <svg class="w-8 h-8 text-gray-600 mb-3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
                    </svg>
                    <div class="font-medium text-gray-800">FAQ</div>
                    <div class="text-xs text-gray-500 mt-1">Частые вопросы</div>
                </div>
            </div>
        </div>

        <!-- Галерея (большой блок) -->
        <div class="card mb-4 border-2 border-transparent hover:border-blue-300 transition-all cursor-pointer" style="background: #F0F7FF;" onclick="showComingSoon()">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <div class="card-label mb-1" style="color: #4A90D9;">Галерея</div>
                    <div class="text-xl font-semibold text-gray-800">24 фото с вами</div>
                </div>
                <a href="#" class="text-sm font-medium hover:underline flex items-center gap-1" style="color: #4A90D9;">
                    Смотреть все
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                    </svg>
                </a>
            </div>

            <!-- Прокрутка фото -->
            <div class="relative">
                <div class="flex gap-3 overflow-x-auto hide-scrollbar pb-2 snap-x snap-mandatory">
                    <!-- Фото 1 (горизонтальное большое) -->
                    <div class="flex-shrink-0 w-64 h-44 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-transform snap-start relative group">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-12 h-12 text-blue-300" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                            </svg>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-3 opacity-0 group-hover:opacity-100 transition-opacity">
                            <div class="text-white text-sm">Фестиваль 2025</div>
                        </div>
                    </div>

                    <!-- Фото 2 (вертикальное - узкое) -->
                    <div class="flex-shrink-0 w-28 h-44 bg-gradient-to-br from-indigo-100 to-indigo-200 rounded-xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-transform snap-start relative group">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-8 h-8 text-indigo-300" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Фото 3 (квадратное) -->
                    <div class="flex-shrink-0 w-44 h-44 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-transform snap-start relative group">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-10 h-10 text-purple-300" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Фото 4 (вертикальное - узкое) -->
                    <div class="flex-shrink-0 w-32 h-44 bg-gradient-to-br from-rose-100 to-rose-200 rounded-xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-transform snap-start relative group">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-8 h-8 text-rose-300" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Фото 5 (горизонтальное) -->
                    <div class="flex-shrink-0 w-56 h-44 bg-gradient-to-br from-cyan-100 to-cyan-200 rounded-xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-transform snap-start relative group">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-10 h-10 text-cyan-300" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Фото 6 (квадратное) -->
                    <div class="flex-shrink-0 w-44 h-44 bg-gradient-to-br from-teal-100 to-teal-200 rounded-xl overflow-hidden cursor-pointer hover:scale-[1.02] transition-transform snap-start relative group">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-10 h-10 text-teal-300" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                            </svg>
                        </div>
                    </div>

                    <!-- Ещё фото -->
                    <div class="flex-shrink-0 w-36 h-44 bg-blue-50 rounded-xl overflow-hidden cursor-pointer hover:bg-blue-100 transition-colors snap-start flex items-center justify-center">
                        <div class="text-center">
                            <div class="text-3xl font-light text-blue-400">+18</div>
                            <div class="text-sm text-blue-400 mt-1">фото</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Нижние карточки -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <!-- Контакты -->
            <div class="card border-2 border-transparent hover:border-gray-200 transition-all">
                <div class="card-label">Контакты</div>
                <div class="font-medium text-gray-800">Нужна помощь?</div>

                <div class="mt-3 text-sm space-y-2">
                    <a href="https://t.me/guesthouse_SRSK" target="_blank" class="flex items-center gap-2 text-gray-600 hover:text-[#26A5E4] transition-colors">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>
                        <span>Нитья-виласини деви даси</span>
                    </a>
                    <a href="https://t.me/VanamaliGopal" target="_blank" class="flex items-center gap-2 text-gray-600 hover:text-[#26A5E4] transition-colors">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>
                        <span>Ванамали Гопал дас</span>
                    </a>
                    <a href="https://t.me/o_karpov" target="_blank" class="flex items-center gap-2 text-gray-600 hover:text-[#26A5E4] transition-colors">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>
                        <span>Олег Карпов</span>
                    </a>
                </div>
            </div>

            <!-- Сообщество -->
            <div class="card cursor-pointer border-2 border-transparent hover:border-emerald-200 transition-all" style="background: #F0FFF4;">
                <div class="card-label">Сообщество</div>
                <div class="font-medium text-gray-800">Присоединяйтесь</div>

                <div class="mt-4 flex gap-2 flex-wrap">
                    <!-- Telegram -->
                    <a href="https://t.me/rupaseva" target="_blank" class="w-9 h-9 bg-gray-100 rounded-full flex items-center justify-center cursor-pointer hover:bg-[#26A5E4] hover:text-white transition-colors text-gray-600">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>
                    </a>
                    <!-- YouTube -->
                    <a href="https://www.youtube.com/@Rupaseva" target="_blank" class="w-9 h-9 bg-gray-100 rounded-full flex items-center justify-center cursor-pointer hover:bg-[#FF0000] hover:text-white transition-colors text-gray-600">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                    </a>
                    <!-- RuTube -->
                    <a href="https://rutube.ru/channel/67606039/" target="_blank" class="w-9 h-9 bg-gray-100 rounded-full flex items-center justify-center cursor-pointer hover:bg-[#000000] hover:text-white transition-colors text-gray-600">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12.76 11.54c.56 0 .86-.24.86-.72 0-.5-.3-.74-.86-.74h-1.12v1.46h1.12zm8.67-7.38v15.68a2.62 2.62 0 01-2.62 2.62H5.2a2.62 2.62 0 01-2.62-2.62V4.16A2.62 2.62 0 015.2 1.54h13.61a2.62 2.62 0 012.62 2.62zm-5.27 6.4c0-1.7-1.18-2.7-3.14-2.7H9.5v8.3h1.94v-2.88h.94l1.42 2.88h2.12l-1.68-3.18c.96-.46 1.52-1.36 1.52-2.42z"/>
                        </svg>
                    </a>
                    <!-- Instagram -->
                    <a href="https://www.instagram.com/rupaseva/" target="_blank" class="w-9 h-9 bg-gray-100 rounded-full flex items-center justify-center cursor-pointer hover:bg-gradient-to-br hover:from-[#833AB4] hover:via-[#FD1D1D] hover:to-[#F77737] hover:text-white transition-colors text-gray-600">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"/>
                        </svg>
                    </a>
                    <!-- VK -->
                    <a href="https://vk.com/rupaseva" target="_blank" class="w-9 h-9 bg-gray-100 rounded-full flex items-center justify-center cursor-pointer hover:bg-[#0077FF] hover:text-white transition-colors text-gray-600">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15.684 0H8.316C1.592 0 0 1.592 0 8.316v7.368C0 22.408 1.592 24 8.316 24h7.368C22.408 24 24 22.408 24 15.684V8.316C24 1.592 22.391 0 15.684 0zm3.692 17.123h-1.744c-.66 0-.864-.525-2.05-1.727-1.033-1-1.49-1.135-1.744-1.135-.356 0-.458.102-.458.593v1.575c0 .424-.135.678-1.253.678-1.846 0-3.896-1.118-5.335-3.202C4.624 10.857 4.03 8.57 4.03 8.096c0-.254.102-.491.593-.491h1.744c.44 0 .61.203.78.677.863 2.49 2.303 4.675 2.896 4.675.22 0 .322-.102.322-.66V9.721c-.068-1.186-.695-1.287-.695-1.71 0-.203.17-.407.44-.407h2.744c.373 0 .508.203.508.643v3.473c0 .372.17.508.271.508.22 0 .407-.136.813-.542 1.254-1.406 2.151-3.574 2.151-3.574.119-.254.322-.491.763-.491h1.744c.525 0 .644.27.525.643-.22 1.017-2.354 4.031-2.354 4.031-.186.305-.254.44 0 .78.186.254.796.779 1.203 1.253.745.847 1.32 1.558 1.473 2.05.17.49-.085.744-.576.744z"/>
                        </svg>
                    </a>
                </div>
            </div>

        </div>

    </div>
    </main>

    <!-- Photo Crop Modal -->
    <div id="cropModal" class="fixed inset-0 bg-black/70 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-4 border-b flex items-center justify-between">
                <h3 class="font-semibold text-lg text-gray-800">Редактирование фото</h3>
                <button type="button" onclick="closeCropModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-4">
                <div class="flex flex-col md:flex-row gap-6">
                    <!-- Crop area -->
                    <div class="flex-1">
                        <div class="bg-gray-100 rounded-lg overflow-hidden" style="height: 300px;">
                            <img id="cropImage" src="" alt="" style="max-width: 100%; display: block;">
                        </div>
                        <!-- Zoom controls -->
                        <div class="flex items-center justify-center gap-4 mt-4">
                            <button type="button" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200" onclick="cropper?.zoom(-0.1)">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg>
                            </button>
                            <input type="range" id="zoomRange" min="0.1" max="3" step="0.1" value="1" class="w-32 accent-srsk-green" oninput="handleZoomRange(this.value)">
                            <button type="button" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200" onclick="cropper?.zoom(0.1)">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                            </button>
                            <button type="button" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200" onclick="cropper?.rotate(-90)">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                            </button>
                        </div>
                    </div>
                    <!-- Preview -->
                    <div class="flex flex-col items-center gap-2">
                        <div class="text-sm text-gray-500">Предпросмотр</div>
                        <div id="cropPreview" class="w-28 h-28 rounded-full overflow-hidden bg-gray-100"></div>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t flex justify-end gap-3">
                <button type="button" onclick="closeCropModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Отмена</button>
                <button type="button" onclick="saveCroppedPhoto()" class="px-4 py-2 bg-srsk-green text-white rounded-lg hover:bg-srsk-green/90">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Photo View Modal -->
    <div id="photoViewModal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4" onclick="closePhotoModal()">
        <div class="relative max-w-lg w-full" onclick="event.stopPropagation()">
            <button type="button" onclick="closePhotoModal()" class="absolute -top-12 right-0 text-white/70 hover:text-white transition-colors">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <img id="photoViewImage" src="" alt="" class="w-full rounded-2xl shadow-2xl">
            <div id="photoViewName" class="text-center text-white text-lg font-medium mt-4"></div>
        </div>
    </div>

    <!-- Coming Soon Modal -->
    <div id="comingSoonModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4" onclick="closeComingSoon()">
        <div class="bg-white rounded-2xl p-6 max-w-sm w-full text-center shadow-xl" onclick="event.stopPropagation()">
            <div class="w-16 h-16 bg-srsk-orange/10 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-srsk-orange" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z" />
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">Раздел в разработке</h3>
            <p class="text-gray-500 mb-6">Скоро появится</p>
            <button onclick="closeComingSoon()" class="w-full bg-srsk-green text-white font-medium py-2.5 px-4 rounded-xl hover:bg-srsk-green/90 transition-colors">
                Ок
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/portal-config.js"></script>
    <script src="js/portal-auth.js"></script>
    <script src="js/portal-data.js"></script>
    <script>
        let photoFile = null;
        let cropper = null;

        // Photo View Modal
        function openPhotoModal() {
            const guest = window.currentGuest;
            if (!guest?.photoUrl) return;

            document.getElementById('photoViewImage').src = guest.photoUrl;
            document.getElementById('photoViewName').textContent = getDisplayName(guest);
            document.getElementById('photoViewModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closePhotoModal() {
            document.getElementById('photoViewModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Coming Soon Modal
        function showComingSoon() {
            document.getElementById('comingSoonModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeComingSoon() {
            document.getElementById('comingSoonModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Закрытие по Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closePhotoModal();
                closeComingSoon();
            }
        });

        // Форматирование даты рождения
        function formatBirthDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const months = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня',
                           'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        // Получить отображаемое имя
        function getDisplayName(guest) {
            return guest.spiritualName ||
                   `${guest.firstName || ''} ${guest.lastName || ''}`.trim() ||
                   'Гость';
        }

        // Получить статус пользователя
        function getUserStatus(userType) {
            const statuses = {
                'guest': 'Гость',
                'staff': 'Команда',
                'admin': 'Администратор'
            };
            return statuses[userType] || 'Гость';
        }

        // Заполнить профиль данными
        function populateProfile(guest) {
            // Фото
            const photoContainer = document.getElementById('profile-photo');
            if (guest.photoUrl) {
                photoContainer.innerHTML = `<img src="${guest.photoUrl}" alt="Фото" class="w-full h-full object-cover">`;
            }

            // Имена
            document.getElementById('profile-spiritual-name').textContent = guest.spiritualName || '';
            document.getElementById('profile-civil-name').textContent =
                `${guest.firstName || ''} ${guest.lastName || ''}`.trim();

            // Локация
            const location = [guest.country, guest.city].filter(Boolean).join(', ');
            const locationEl = document.getElementById('profile-location');
            if (location) {
                locationEl.querySelector('span').textContent = location;
                locationEl.classList.remove('hidden');
            } else {
                locationEl.classList.add('hidden');
            }

            // Дата рождения
            const birthEl = document.getElementById('profile-birthdate');
            if (guest.birthDate) {
                birthEl.querySelector('span').textContent = formatBirthDate(guest.birthDate);
                birthEl.classList.remove('hidden');
            } else {
                birthEl.classList.add('hidden');
            }

            // Духовный учитель
            const teacherEl = document.getElementById('profile-teacher');
            if (guest.spiritualTeacher) {
                teacherEl.querySelector('span').textContent = guest.spiritualTeacher;
                teacherEl.classList.remove('hidden');
            } else {
                teacherEl.classList.add('hidden');
            }

            // Статус
            document.getElementById('profile-status').textContent = getUserStatus(guest.userType);

            // Телефон
            const phoneEl = document.getElementById('profile-phone');
            if (guest.phone) {
                phoneEl.querySelector('span').textContent = guest.phone;
                phoneEl.classList.remove('hidden');
            } else {
                phoneEl.classList.add('hidden');
            }

            // Telegram (данные в поле telegram, не telegram_username)
            const tgEl = document.getElementById('profile-telegram');
            const tgHandle = guest.telegram || guest.telegramUsername;
            if (tgHandle && tgHandle.includes('@')) {
                const username = tgHandle.startsWith('@') ? tgHandle : `@${tgHandle}`;
                tgEl.href = `https://t.me/${tgHandle.replace('@', '')}`;
                tgEl.querySelector('span').textContent = username;
                tgEl.classList.remove('hidden');
            } else {
                tgEl.classList.add('hidden');
            }

            // Заполненность профиля
            const completeness = PortalAuth.getProfileCompleteness();
            document.getElementById('profile-completeness-value').textContent = `${completeness}%`;
            document.getElementById('profile-completeness-bar').style.width = `${completeness}%`;

            // Имя в шапке
            document.getElementById('header-name').textContent = getDisplayName(guest);
            document.getElementById('mobile-name').textContent = getDisplayName(guest);

            // Фото в шапке
            if (guest.photoUrl) {
                document.getElementById('header-photo').innerHTML =
                    `<img src="${guest.photoUrl}" alt="" class="w-full h-full object-cover">`;
            }
        }

        // Переключение режима редактирования
        function toggleProfileEdit(editMode) {
            const viewEl = document.getElementById('profile-view');
            const editEl = document.getElementById('profile-edit');

            if (editMode) {
                viewEl.classList.add('hidden');
                editEl.classList.remove('hidden');
                fillEditForm(window.currentGuest);
            } else {
                viewEl.classList.remove('hidden');
                editEl.classList.add('hidden');
                photoFile = null;
            }
        }

        // Заполнить форму редактирования
        function fillEditForm(guest) {
            document.getElementById('edit-spiritualName').value = guest.spiritualName || '';
            document.getElementById('edit-firstName').value = guest.firstName || '';
            document.getElementById('edit-lastName').value = guest.lastName || '';
            document.getElementById('edit-country').value = guest.country || '';
            document.getElementById('edit-city').value = guest.city || '';
            document.getElementById('edit-birthDate').value = guest.birthDate || '';
            document.getElementById('edit-spiritualTeacher').value = guest.spiritualTeacher || '';
            document.getElementById('edit-phone').value = guest.phone || '';
            document.getElementById('edit-telegram').value = guest.telegram || '';
            document.getElementById('edit-is-public').checked = guest.isProfilePublic !== false;

            // Фото
            const preview = document.getElementById('edit-photo-preview');
            const placeholder = document.getElementById('edit-photo-placeholder');
            if (guest.photoUrl) {
                preview.src = guest.photoUrl;
                preview.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                preview.classList.add('hidden');
                placeholder.classList.remove('hidden');
            }
        }

        // Инициализация загрузки фото
        function initPhotoUpload() {
            const uploadArea = document.getElementById('edit-photo-upload');
            const input = document.getElementById('edit-photo-input');

            uploadArea.addEventListener('click', (e) => {
                if (e.target !== input) {
                    input.click();
                }
            });

            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                // Проверка размера (макс 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Файл слишком большой (максимум 5MB)');
                    return;
                }

                // Проверка типа
                if (!file.type.startsWith('image/')) {
                    alert('Выберите изображение');
                    return;
                }

                // Открываем кроппер
                const reader = new FileReader();
                reader.onload = (e) => {
                    openCropModal(e.target.result);
                };
                reader.readAsDataURL(file);
            });
        }

        // Открыть модальное окно кроппера
        function openCropModal(imageSrc) {
            const modal = document.getElementById('cropModal');
            const cropImage = document.getElementById('cropImage');

            cropImage.src = imageSrc;
            modal.classList.remove('hidden');

            if (cropper) {
                cropper.destroy();
                cropper = null;
            }

            cropImage.onload = function() {
                cropper = new Cropper(cropImage, {
                    aspectRatio: 1,
                    viewMode: 2,
                    dragMode: 'move',
                    autoCropArea: 0.9,
                    restore: false,
                    guides: true,
                    center: true,
                    highlight: false,
                    cropBoxMovable: true,
                    cropBoxResizable: false,
                    toggleDragModeOnDblclick: false,
                    preview: '#cropPreview',
                    ready: () => document.getElementById('zoomRange').value = 1,
                    zoom: (e) => {
                        if (e.detail.ratio > 3) { e.preventDefault(); cropper.zoomTo(3); }
                        if (e.detail.ratio < 0.1) { e.preventDefault(); cropper.zoomTo(0.1); }
                        document.getElementById('zoomRange').value = e.detail.ratio;
                    }
                });
            };
        }

        // Закрыть кроппер
        function closeCropModal() {
            document.getElementById('cropModal').classList.add('hidden');
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
            document.getElementById('edit-photo-input').value = '';
        }

        // Zoom slider
        function handleZoomRange(value) {
            if (cropper) cropper.zoomTo(parseFloat(value));
        }

        // Сохранить обрезанное фото
        function saveCroppedPhoto() {
            if (!cropper) return;

            const canvas = cropper.getCroppedCanvas({
                width: 1000,
                height: 1000,
                imageSmoothingEnabled: true,
                imageSmoothingQuality: 'high'
            });

            canvas.toBlob((blob) => {
                photoFile = new File([blob], 'photo.jpg', { type: 'image/jpeg' });

                // Показываем превью
                const preview = document.getElementById('edit-photo-preview');
                const placeholder = document.getElementById('edit-photo-placeholder');
                preview.src = canvas.toDataURL('image/jpeg', 0.95);
                preview.classList.remove('hidden');
                placeholder.classList.add('hidden');

                closeCropModal();
            }, 'image/jpeg', 0.95);
        }

        // Сохранение профиля
        async function handleProfileSave(e) {
            e.preventDefault();

            const saveBtn = document.getElementById('save-profile-btn');
            const spinner = document.getElementById('save-spinner');

            saveBtn.disabled = true;
            spinner.classList.remove('hidden');

            try {
                const guest = window.currentGuest;
                let photoUrl = guest.photoUrl;

                // Загружаем фото если выбрано
                if (photoFile) {
                    const uploadResult = await PortalData.uploadPhoto(photoFile, guest.id);
                    if (uploadResult.success) {
                        photoUrl = uploadResult.url;
                    } else {
                        alert('Ошибка загрузки фото');
                    }
                }

                // Собираем данные
                const profileData = {
                    firstName: document.getElementById('edit-firstName').value.trim(),
                    lastName: document.getElementById('edit-lastName').value.trim(),
                    spiritualName: document.getElementById('edit-spiritualName').value.trim(),
                    spiritualTeacher: document.getElementById('edit-spiritualTeacher').value.trim(),
                    phone: document.getElementById('edit-phone').value.trim(),
                    telegram: document.getElementById('edit-telegram').value.trim(),
                    country: document.getElementById('edit-country').value.trim(),
                    city: document.getElementById('edit-city').value.trim(),
                    birthDate: document.getElementById('edit-birthDate').value || null,
                    photoUrl: photoUrl,
                    isProfilePublic: document.getElementById('edit-is-public').checked
                };

                // Сохраняем
                const result = await PortalData.updateProfile(guest.id, profileData);

                if (result.success) {
                    // Обновляем локальные данные
                    Object.assign(window.currentGuest, profileData);

                    // Обновляем UI
                    populateProfile(window.currentGuest);
                    toggleProfileEdit(false);
                } else {
                    alert('Ошибка сохранения: ' + (result.error || 'Неизвестная ошибка'));
                }

            } catch (error) {
                console.error('Ошибка сохранения:', error);
                alert('Ошибка сохранения профиля');
            } finally {
                saveBtn.disabled = false;
                spinner.classList.add('hidden');
            }
        }

        // Форматирование даты ретрита
        function formatRetreatDates(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const months = ['янв', 'фев', 'мар', 'апр', 'мая', 'июн', 'июл', 'авг', 'сен', 'окт', 'ноя', 'дек'];

            if (start.getMonth() === end.getMonth()) {
                return `${start.getDate()}–${end.getDate()} ${months[start.getMonth()]}`;
            }
            return `${start.getDate()} ${months[start.getMonth()]} – ${end.getDate()} ${months[end.getMonth()]}`;
        }

        // Загрузить ближайшие ретриты
        async function loadUpcomingRetreats() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const { data, error } = await window.portalSupabase
                    .from('retreats')
                    .select('id, name_ru, start_date, end_date, description_ru, image_url, registration_open')
                    .gte('start_date', today)
                    .order('start_date')
                    .limit(3);

                if (error) throw error;

                const container = document.getElementById('upcoming-retreats');
                if (!data || data.length === 0) {
                    container.innerHTML = '<div class="col-span-3 text-center text-gray-500 py-8">Нет запланированных ретритов</div>';
                    return;
                }

                container.innerHTML = data.map(retreat => `
                    <a href="retreat.html?id=${retreat.id}" class="bg-white rounded-xl overflow-hidden border-2 border-transparent hover:border-[#6B5B95] transition-all flex group">
                        <div class="w-28 bg-gray-100 flex-shrink-0 flex items-center justify-center overflow-hidden">
                            ${retreat.image_url
                                ? `<img src="${retreat.image_url}" alt="" class="w-full h-full object-cover">`
                                : `<img src="images/tilak-placeholder.svg" alt="" class="w-12 h-12 opacity-30">`
                            }
                        </div>
                        <div class="p-3 flex flex-col flex-1">
                            <div class="text-xs text-srsk-green font-medium">${formatRetreatDates(retreat.start_date, retreat.end_date)}</div>
                            <div class="font-medium text-gray-800 text-sm mt-1">${retreat.name_ru}</div>
                            <div class="text-xs text-gray-500 mt-1 line-clamp-2">${retreat.description_ru || ''}</div>
                            <div class="text-xs text-srsk-orange font-medium mt-auto pt-2 flex items-center gap-1 group-hover:underline">
                                Подать заявку
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"/></svg>
                            </div>
                        </div>
                    </a>
                `).join('');

            } catch (e) {
                console.error('Ошибка загрузки ретритов:', e);
            }
        }

        // Загрузить список учителей для автокомплита
        async function loadTeachersList() {
            try {
                const { data, error } = await window.portalSupabase
                    .from('vaishnavas')
                    .select('spiritual_teacher')
                    .not('spiritual_teacher', 'is', null)
                    .not('spiritual_teacher', 'eq', '');

                if (error) throw error;

                // Уникальные значения
                const teachers = [...new Set(data.map(d => d.spiritual_teacher))].sort();
                const datalist = document.getElementById('teachers-list');
                datalist.innerHTML = teachers.map(t => `<option value="${t}">`).join('');
            } catch (e) {
                console.error('Ошибка загрузки учителей:', e);
            }
        }

        // Инициализация
        async function init() {
            const guest = await PortalAuth.checkGuestAuth();
            if (guest) {
                populateProfile(guest);
                initPhotoUpload();
                loadTeachersList();
                loadUpcomingRetreats();
                document.getElementById('profile-form').addEventListener('submit', handleProfileSave);
            }
        }

        init();
    </script>
</body>
</html>
